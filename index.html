<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>AIå°æ‰‹æœºÂ·ç»ˆæå¢å¼ºç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{max-width:420px;margin:0 auto;height:100vh;overflow:hidden;border:1px solid #ddd}
.screen{display:none;height:100%;overflow-y:auto}
.active{display:block}

/* ä¸»é¢˜ç³»ç»Ÿ */
:root{
  --main:#ff69b4;--bg:#fff;--card:#fafafa;--text:#222;--gray:#888;
  --shadow:0 2px 8px rgba(0,0,0,.05);--radius:18px;
}
body{background:var(--bg);color:var(--text)}

/* é”å± + å£çº¸ */
#lock{
  background:linear-gradient(135deg,var(--main),#999);
  background-size:cover;
  background-position:center;
  color:#fff;text-align:center;padding-top:65%
}
#unlock{margin-top:40px;padding:14px 36px;border-radius:30px;border:none;background:#fff;color:var(--main);font-size:16px}
#set_wallpaper{margin-top:20px;padding:8px 20px;border-radius:20px;border:none;background:#fff;color:var(--main);font-size:14px}

/* æ¡Œé¢ */
#home{padding:20px}
.home-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.app-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.app{background:var(--card);border-radius:var(--radius);padding:12px 8px;text-align:center;box-shadow:var(--shadow)}
.app-icon{width:44px;height:44px;background:var(--main);color:#fff;border-radius:14px;margin:0 auto 6px;display:grid;place-items:center;font-size:20px}
.app-name{font-size:12px}

/* æ ‡é¢˜æ  */
.head{display:flex;align-items:center;gap:12px;padding:16px;background:var(--card);border-bottom:1px solid #eee}
.head button{border:none;background:transparent;font-size:20px;color:var(--text)}
.head h3{flex:1}

/* èŠå¤© */
#msgs{height:68vh;padding:16px;overflow-y:auto}
.msg{max-width:75%;padding:10px 14px;border-radius:var(--radius);margin:6px 0;line-height:1.4}
.user{background:var(--main);color:#fff;margin-left:auto}
.ai{background:var(--card);margin-right:auto}
.msg img{max-width:100%;border-radius:12px;margin:8px 0}
.msg code{background:#f1f1f1;padding:2px 6px;border-radius:4px;font-family:monospace}
.msg pre{background:#f1f1f1;padding:12px;border-radius:8px;overflow-x:auto}
.msg strong{font-weight:600}
.msg em{font-style:italic}
.msg ul{margin-left:20px}
.msg li{margin:4px 0}
.input-bar{display:flex;gap:8px;padding:12px;background:var(--card)}
#input{flex:1;border:none;border-radius:24px;padding:12px 16px;background:#f1f1f1;outline:none}
#send{width:48px;height:48px;border-radius:50%;background:var(--main);color:#fff;border:none}
.toolbar{display:flex;gap:10px;padding:8px 16px;background:var(--card)}
.tool{width:40px;height:40px;border-radius:12px;background:var(--bg);border:none}

/* è¡¨æƒ…é¢æ¿ */
#emoji{position:fixed;bottom:0;left:0;right:0;background:var(--card);padding:12px;display:grid;grid-template-columns:repeat(8,1fr);gap:6px;display:none}
#emoji.active{display:grid}
.emoji{font-size:20px;padding:6px;text-align:center}
.custom-emoji{width:32px;height:32px;object-fit:cover;border-radius:8px}
#add_emoji{position:absolute;bottom:10px;right:10px;width:32px;height:32px;border-radius:50%;background:var(--main);color:#fff;border:none;font-size:16px}

/* å¼¹çª— */
.pop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;place-items:center}
.pop.active{display:grid}
.pop-box{background:var(--card);width:85%;border-radius:20px;padding:24px}
.pop-btn{display:flex;gap:12px;margin-top:16px}
.pop-btn button{flex:1;padding:10px;border-radius:12px;border:none}

/* è®¾ç½®é¡¹ */
.item{display:flex;justify-content:space-between;align-items:center;padding:16px;background:var(--card);border-bottom:1px solid #eee}
.item input,.item select{border:1px solid #ddd;border-radius:8px;padding:8px 12px;width:160px;background:var(--bg)}
.color-picker{width:40px;height:40px;border-radius:8px;border:none}

/* åˆ—è¡¨å¡ç‰‡ */
.list{padding:12px}
.card{background:var(--card);padding:16px;border-radius:12px;margin-bottom:10px;box-shadow:var(--shadow)}
.add-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--main);color:#fff;border:none;font-size:24px}

/* APIå¹³å°é€‰æ‹© */
.platform-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--card);border-bottom:1px solid #eee}
.platform-item img{width:24px;height:24px}
.platform-item.active{background:var(--main);color:#fff}
</style>
</head>
<body>

<!-- é”å± -->
<div id="lock" class="screen active">
  <h2>AIå°æ‰‹æœº</h2><p>ä¸“å±æ™ºèƒ½ç»ˆç«¯</p>
  <button id="unlock" onclick="unlock()">ç‚¹æˆ‘è§£é”</button>
  <button id="set_wallpaper" onclick="setLockWallpaper()">è®¾ç½®å£çº¸</button>
</div>

<!-- æ¡Œé¢ -->
<div id="home" class="screen">
  <div class="home-title"><h2>æ¡Œé¢</h2><span id="time"></span></div>
  <div class="app-grid">
    <div class="app" onclick="go('chat')"><div class="app-icon">ğŸ’¬</div><div class="app-name">èŠå¤©</div></div>
    <div class="app" onclick="go('api')"><div class="app-icon">ğŸ”Œ</div><div class="app-name">API</div></div>
    <div class="app" onclick="go('world')"><div class="app-icon">ğŸ“š</div><div class="app-name">ä¸–ç•Œä¹¦</div></div>
    <div class="app" onclick="go('preset')"><div class="app-icon">ğŸ­</div><div class="app-name">é¢„è®¾</div></div>
    <div class="app" onclick="go('theme')"><div class="app-icon">ğŸ¨</div><div class="app-name">ä¸»é¢˜</div></div>
    <div class="app" onclick="go('memory')"><div class="app-icon">ğŸ§ </div><div class="app-name">è®°å¿†</div></div>
    <div class="app" onclick="go('tools')"><div class="app-icon">âš™ï¸</div><div class="app-name">è„šæœ¬</div></div>
    <div class="app" onclick="go('import')"><div class="app-icon">ğŸ“¤</div><div class="app-name">å¯¼å…¥å¯¼å‡º</div></div>
  </div>
</div>

<!-- èŠå¤© -->
<div id="chat" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>èŠå¤©</h3></div>
  <div id="msgs"></div>
  <div class="toolbar">
    <button class="tool" onclick="toggleEmoji()">ğŸ˜Š</button>
    <button class="tool" onclick="pickImg()">ğŸ–¼ï¸</button>
    <button class="tool" onclick="showTransfer()">ğŸ’¸</button>
    <button class="tool" onclick="showCall()">ğŸ“</button>
  </div>
  <div id="emoji">
    <button id="add_emoji" onclick="addCustomEmoji()">+</button>
  </div>
  <div class="input-bar">
    <input id="input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeydown="event.key==='Enter'&&send()">
    <button id="send" onclick="send()">â¤</button>
  </div>
</div>

<!-- APIè®¾ç½® -->
<div id="api" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>APIé…ç½®</h3></div>
  <div class="item"><label>è¿æ¥åç§°</label><input id="api_name" value="APIè¿æ¥ 18"></div>
  <div class="item"><label>æ¨¡å‹å¹³å°</label>
    <select id="api_platform">
      <option value="volink">Volink</option>
      <option value="openai">OpenAI</option>
      <option value="claude">Claude (Anthropic)</option>
      <option value="gemini">Gemini (Google AI Studio)</option>
      <option value="grok">Grok (xAI)</option>
      <option value="deepseek">DeepSeek (æ·±åº¦æ±‚ç´¢)</option>
      <option value="doubao">Doubao (è±†åŒ…/ç«å±±äº‘/å­—èŠ‚è·³åŠ¨)</option>
      <option value="openrouter">OpenRouter</option>
      <option value="custom_openai">è‡ªå®šä¹‰ (OpenAI åè®®)</option>
      <option value="custom_gemini">è‡ªå®šä¹‰ (Gemini åè®®)</option>
    </select>
  </div>
  <div class="item"><label>æ¥å£åœ°å€</label><input id="api_url"></div>
  <div class="item"><label>API Key</label><input id="api_key" type="password"></div>
  <div class="item"><label>æ¨¡å‹åç§°</label><input id="api_model"></div>
  <div class="item"><button onclick="saveAPI()" style="padding:8px 16px;background:var(--main);color:#fff;border:none;border-radius:12px">ä¿å­˜</button></div>
</div>

<!-- ä¸–ç•Œä¹¦ -->
<div id="world" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>ä¸–ç•Œä¹¦</h3></div>
  <div class="list" id="world_list"></div>
  <button class="add-btn" onclick="addWorld()">+</button>
</div>

<!-- è§’è‰²é¢„è®¾ -->
<div id="preset" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>è§’è‰²é¢„è®¾</h3></div>
  <div class="list" id="pre_list"></div>
  <button class="add-btn" onclick="addPreset()">+</button>
</div>

<!-- ä¸»é¢˜ -->
<div id="theme" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>ä¸»é¢˜</h3></div>
  <div class="item"><label>ä¸»è‰²è°ƒ</label><input type="color" class="color-picker" id="main_color" onchange="setMain()"></div>
  <div class="item"><label>èƒŒæ™¯è‰²</label><input type="color" class="color-picker" id="bg_color" onchange="setBg()"></div>
  <div class="item"><label>å¡ç‰‡è‰²</label><input type="color" class="color-picker" id="card_color" onchange="setCard()"></div>
  <div class="item"><label>æ–‡å­—è‰²</label><input type="color" class="color-picker" id="text_color" onchange="setText()"></div>
  <div class="item"><button onclick="resetTheme()" style="padding:8px 16px;background:var(--main);color:#fff;border:none;border-radius:12px">é‡ç½®</button></div>
</div>

<!-- è®°å¿† -->
<div id="memory" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>é•¿æœŸè®°å¿†</h3></div>
  <div class="list" id="mem_list"></div>
</div>

<!-- è„šæœ¬&æ­£åˆ™&ä¸»åŠ¨ -->
<div id="tools" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>è„šæœ¬å·¥å…·</h3></div>
  <div class="item"><label>ä¸»åŠ¨å‘è¨€(ç§’)</label><input id="act_time" value="60"></div>
  <div class="item"><button onclick="startActive()">å¼€å¯ä¸»åŠ¨å‘è¨€</button></div>
  <div class="item"><label>æ­£åˆ™æ›¿æ¢(aâ†’b)</label><input id="reg_rule"></div>
  <div class="item"><label>è‡ªå®šä¹‰è„šæœ¬</label><textarea id="custom_script" rows="5" style="width:160px;border:1px solid #ddd;border-radius:8px;padding:8px"></textarea></div>
  <div class="item"><button onclick="runScript()" style="padding:8px 16px;background:var(--main);color:#fff;border:none;border-radius:12px">è¿è¡Œè„šæœ¬</button></div>
</div>

<!-- å¯¼å…¥å¯¼å‡º -->
<div id="import" class="screen">
  <div class="head"><button onclick="go('home')">â†</button><h3>å¯¼å…¥å¯¼å‡º</h3></div>
  <div class="item"><button onclick="importSTAll()">å¯¼å…¥SillyTavernå…¨éƒ¨æ•°æ®</button></div>
  <div class="item"><button onclick="importSTRole()">å¯¼å…¥SillyTavernè§’è‰²</button></div>
  <div class="item"><button onclick="importSTPreset()">å¯¼å…¥SillyTaverné¢„è®¾</button></div>
  <div class="item"><button onclick="importSTWorld()">å¯¼å…¥SillyTavernä¸–ç•Œä¹¦</button></div>
  <div class="item"><button onclick="importSTScript()">å¯¼å…¥SillyTavernè„šæœ¬</button></div>
  <div class="item"><button onclick="importSTTheme()">å¯¼å…¥SillyTavernä¸»é¢˜</button></div>
  <div class="item"><button onclick="exportData()">å¯¼å‡ºå…¨éƒ¨æ•°æ®</button></div>
</div>

<!-- è½¬è´¦å¼¹çª— -->
<div class="pop" id="transfer_pop">
  <div class="pop-box">
    <h3>è½¬è´¦</h3>
    <input id="money" placeholder="é‡‘é¢" type="number">
    <input id="note" placeholder="å¤‡æ³¨">
    <div class="pop-btn">
      <button onclick="closePop()">å–æ¶ˆ</button>
      <button onclick="sendTransfer()" style="background:var(--main);color:#fff">ç¡®è®¤</button>
    </div>
  </div>
</div>

<!-- é€šè¯å¼¹çª— -->
<div class="pop" id="call_pop">
  <div class="pop-box" style="text-align:center">
    <h3>è¯­éŸ³é€šè¯</h3><p>è¿æ¥ä¸­...</p>
    <button onclick="closePop()" style="background:red;color:#fff;margin-top:20px;padding:10px 30px;border-radius:30px">æŒ‚æ–­</button>
  </div>
</div>

<script>
// æœ¬åœ°æ•°æ®
let data = JSON.parse(localStorage.getItem("AI_PHONE_ULTIMATE")) || {
  api:{name:"APIè¿æ¥ 18",platform:"volink",url:"",key:"",model:""},
  theme:{main:"#ff69b4",bg:"#fff",card:"#fafafa",text:"#222"},
  world:[{t:"è§’è‰²",c:"æ¸©æŸ”å¯çˆ±çš„AIåŠ©æ‰‹"}],
  preset:[{n:"é»˜è®¤",c:"ä½ æ˜¯æ¸©æŸ”å¯çˆ±çš„AIåŠ©æ‰‹"}],
  memory:[],active:0,reg:"",script:"",
  lockWallpaper:"",
  emojis:["ğŸ˜Š","ğŸ˜‚","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜œ","ğŸ˜","ğŸ˜­","ğŸ‘","â¤ï¸","ğŸ’•","ğŸ’¯","ğŸ˜¢","ğŸ˜±","ğŸ¥³","ğŸ˜¡"]
}

// é¡µé¢åˆ‡æ¢
function go(id){
  document.querySelectorAll(".screen").forEach(e=>e.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="home") renderTime();
}
// è§£é”ï¼ˆä¿®å¤ç‚¹å‡»æ²¡ååº”ï¼‰
function unlock(){
  go("home");
  renderAll();
  setMain();setBg();setCard();setText();
}

// é”å±å£çº¸
function setLockWallpaper(){
  let inp = document.createElement("input");
  inp.type="file";
  inp.accept="image/*";
  inp.onchange = function(){
    let url = URL.createObjectURL(inp.files[0]);
    document.getElementById("lock").style.backgroundImage = "url("+url+")";
    data.lockWallpaper = url;
    save();
  }
  inp.click();
}

// æ—¶é—´æ˜¾ç¤º
function renderTime(){
  let t = new Date();
  document.getElementById("time").textContent = t.getHours()+":"+String(t.getMinutes()).padStart(2,"0");
}
setInterval(renderTime,1000);

// ä¸»é¢˜
function setMain(){document.documentElement.style.setProperty("--main",document.getElementById("main_color").value||data.theme.main)}
function setBg(){document.documentElement.style.setProperty("--bg",document.getElementById("bg_color").value||data.theme.bg)}
function setCard(){document.documentElement.style.setProperty("--card",document.getElementById("card_color").value||data.theme.card)}
function setText(){document.documentElement.style.setProperty("--text",document.getElementById("text_color").value||data.theme.text)}
function resetTheme(){
  data.theme={main:"#ff69b4",bg:"#fff",card:"#fafafa",text:"#222"};
  document.getElementById("main_color").value = data.theme.main;
  document.getElementById("bg_color").value = data.theme.bg;
  document.getElementById("card_color").value = data.theme.card;
  document.getElementById("text_color").value = data.theme.text;
  setMain();setBg();setCard();setText();save();
}

// ä¿å­˜&åŠ è½½
function save(){localStorage.setItem("AI_PHONE_ULTIMATE",JSON.stringify(data))}
function saveAPI(){
  data.api={
    name:document.getElementById("api_name").value,
    platform:document.getElementById("api_platform").value,
    url:document.getElementById("api_url").value,
    key:document.getElementById("api_key").value,
    model:document.getElementById("api_model").value
  };
  save();alert("å·²ä¿å­˜")
}

// èŠå¤©å‘é€
function send(){
  let txt = document.getElementById("input").value.trim();
  if(!txt||!data.api.url)return;
  if(data.reg){let [a,b]=data.reg.split("â†’");if(a)txt=txt.replaceAll(a,b||"")}
  addMsg(txt,"user");
  document.getElementById("input").value="";
  let sys = data.preset[0].c + "\nä¸–ç•Œä¹¦ï¼š" + data.world.map(i=>i.c).join("ï¼›") + "\nè®°å¿†ï¼š" + data.memory.slice(-10).join("ï¼›");
  fetch(data.api.url+"/chat/completions",{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+data.api.key},
    body:JSON.stringify({
      model:data.api.model,
      messages:[
        {role:"system",content:sys},
        {role:"user",content:txt}
      ]
    })
  }).then(r=>r.json()).then(d=>{
    let rep = d.choices[0].message.content;
    addMsg(rep,"ai");
    data.memory.push(txt+"|"+rep);
    save();
  }).catch(()=>addMsg("APIè¿æ¥å¤±è´¥","ai"))
}
function addMsg(t,c){
  let d=document.createElement("div");
  d.className="msg "+c;
  d.innerHTML = t
    .replace(/\n/g,"<br>")
    .replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")
    .replace(/\*(.*?)\*/g,"<em>$1</em>")
    .replace(/`([^`]+)`/g,"<code>$1</code>")
    .replace(/```([^`]+)```/g,"<pre>$1</pre>")
    .replace(/- (.*?)(<br>|$)/g,"<li>$1</li>")
    .replace(/<li>(.*?)<\/li>/g,"<ul><li>$1</li></ul>")
    .replace(/!\[(.*?)\]\((.*?)\)/g,"<img src='$2' alt='$1'>");
  document.getElementById("msgs").appendChild(d);
  document.getElementById("msgs").scrollTop=99999
}

// è¡¨æƒ…åŒ…
function toggleEmoji(){
  let emojiPanel = document.getElementById("emoji");
  emojiPanel.classList.toggle("active");
  if(emojiPanel.classList.contains("active")) renderEmojis();
}
function renderEmojis(){
  let emojiPanel = document.getElementById("emoji");
  emojiPanel.innerHTML = '<button id="add_emoji" onclick="addCustomEmoji()">+</button>';
  data.emojis.forEach(e=>{
    let b=document.createElement("div");
    if(e.startsWith("http")){
      b.className="emoji custom-emoji";
      b.innerHTML = `<img src="${e}" style="width:24px;height:24px">`;
    }else{
      b.className="emoji";
      b.textContent=e;
    }
    b.onclick=()=>{
      document.getElementById("input").value+=e;
      toggleEmoji()
    }
    emojiPanel.appendChild(b)
  })
}
function addCustomEmoji(){
  let inp = document.createElement("input");
  inp.type="file";
  inp.accept="image/*";
  inp.onchange = function(){
    let url = URL.createObjectURL(inp.files[0]);
    data.emojis.push(url);
    save();
    renderEmojis();
  }
  inp.click();
}

// å›¾ç‰‡
function pickImg(){
  let i=document.createElement("input");
  i.type="file";
  i.accept="image/*";
  i.onchange=()=>addMsg("<img src='"+URL.createObjectURL(i.files[0])+"'>","user");
  i.click()
}

// è½¬è´¦&é€šè¯
function showTransfer(){document.getElementById("transfer_pop").classList.add("active")}
function showCall(){document.getElementById("call_pop").classList.add("active")}
function closePop(){document.querySelectorAll(".pop").forEach(e=>e.classList.remove("active"))}
function sendTransfer(){
  let m=document.getElementById("money").value,
      n=document.getElementById("note").value;
  addMsg(`è½¬è´¦Â¥${m}ï½œå¤‡æ³¨ï¼š${n}`,"user");
  closePop()
}

// ä¸–ç•Œä¹¦
function renderWorld(){
  let l=document.getElementById("world_list");
  l.innerHTML="";
  data.world.forEach(i=>{
    let c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h4>${i.t}</h4><p>${i.c}</p>`;
    l.appendChild(c)
  })
}
function addWorld(){
  let t=prompt("æ ‡é¢˜"),c=prompt("å†…å®¹");
  if(t&&c){
    data.world.push({t,c});
    save();renderWorld()
  }
}

// é¢„è®¾
function renderPreset(){
  let l=document.getElementById("pre_list");
  l.innerHTML="";
  data.preset.forEach(i=>{
    let c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h4>${i.n}</h4><p>${i.c}</p>`;
    l.appendChild(c)
  })
}
function addPreset(){
  let n=prompt("é¢„è®¾å"),c=prompt("å†…å®¹");
  if(n&&c){
    data.preset.push({n,c});
    save();renderPreset()
  }
}

// è®°å¿†
function renderMemory(){
  let l=document.getElementById("mem_list");
  l.innerHTML="";
  data.memory.forEach(i=>{
    let c=document.createElement("div");
    c.className="card";
    c.innerText=i;
    l.appendChild(c)
  })
}

// ä¸»åŠ¨å‘è¨€
function startActive(){
  clearInterval(window.act);
  data.reg=document.getElementById("reg_rule").value;
  data.script=document.getElementById("custom_script").value;
  let s=parseInt(document.getElementById("act_time").value)||60;
  save();
  window.act=setInterval(()=>{
    if(data.script) try{eval(data.script)}catch(e){console.error(e)}
    addMsg("æˆ‘æ¥æ‰¾ä½ å•¦ï½","ai")
  },s*1000);
  alert("å·²å¼€å¯")
}
function runScript(){
  try{
    eval(document.getElementById("custom_script").value);
    alert("è„šæœ¬è¿è¡ŒæˆåŠŸ")
  }catch(e){
    alert("è„šæœ¬è¿è¡Œå¤±è´¥ï¼š"+e.message)
  }
}

// å¯¼å…¥SillyTavern
function importSTAll(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.characters?.[0]){
        data.preset=[{n:j.characters[0].name,c:j.characters[0].description}];
      }
      if(j.worldBook?.entries){
        data.world = j.worldBook.entries.map(e=>({t:e.title,c:e.content}));
      }
      if(j.settings?.regex){
        data.reg = j.settings.regex;
      }
      if(j.settings?.customScript){
        data.script = j.settings.customScript;
      }
      if(j.settings?.theme){
        data.theme = j.settings.theme;
      }
      save();renderAll();alert("å…¨éƒ¨æ•°æ®å¯¼å…¥æˆåŠŸ")
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}
function importSTRole(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.characters?.[0]){
        data.preset=[{n:j.characters[0].name,c:j.characters[0].description}];
        save();renderPreset();alert("è§’è‰²å¯¼å…¥æˆåŠŸ")
      }
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}
function importSTPreset(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.presets){
        data.preset = j.presets.map(p=>({n:p.name,c:p.content}));
        save();renderPreset();alert("é¢„è®¾å¯¼å…¥æˆåŠŸ")
      }
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}
function importSTWorld(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.worldBook?.entries){
        data.world = j.worldBook.entries.map(e=>({t:e.title,c:e.content}));
        save();renderWorld();alert("ä¸–ç•Œä¹¦å¯¼å…¥æˆåŠŸ")
      }
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}
function importSTScript(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.settings?.customScript){
        data.script = j.settings.customScript;
        document.getElementById("custom_script").value = data.script;
        save();alert("è„šæœ¬å¯¼å…¥æˆåŠŸ")
      }
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}
function importSTTheme(){
  let i=document.createElement("input");
  i.type="file";
  i.accept=".json";
  i.onchange=e=>{
    let f=new FileReader();
    f.onload=e=>{
      let j=JSON.parse(e.target.result);
      if(j.settings?.theme){
        data.theme = j.settings.theme;
        document.getElementById("main_color").value = data.theme.main;
        document.getElementById("bg_color").value = data.theme.bg;
        document.getElementById("card_color").value = data.theme.card;
        document.getElementById("text_color").value = data.theme.text;
        setMain();setBg();setCard();setText();
        save();alert("ä¸»é¢˜å¯¼å…¥æˆåŠŸ")
      }
    };
    f.readAsText(e.target.files[0])
  };
  i.click()
}

// å¯¼å‡º
function exportData(){
  let a=document.createElement("a");
  a.href="data:application/json,"+encodeURIComponent(JSON.stringify(data));
  a.download="AIå°æ‰‹æœºç»ˆæç‰ˆæ•°æ®.json";
  a.click();
  alert("å¯¼å‡ºæˆåŠŸ")
}

// å…¨éƒ¨æ¸²æŸ“
function renderAll(){
  renderWorld();renderPreset();renderMemory();
  document.getElementById("api_name").value=data.api.name;
  document.getElementById("api_platform").value=data.api.platform;
  document.getElementById("api_url").value=data.api.url;
  document.getElementById("api_key").value=data.api.key;
  document.getElementById("api_model").value=data.api.model;
  document.getElementById("main_color").value = data.theme.main;
  document.getElementById("bg_color").value = data.theme.bg;
  document.getElementById("card_color").value = data.theme.card;
  document.getElementById("text_color").value = data.theme.text;
  document.getElementById("reg_rule").value = data.reg;
  document.getElementById("custom_script").value = data.script;
  if(data.lockWallpaper){
    document.getElementById("lock").style.backgroundImage = "url("+data.lockWallpaper+")";
  }
  setMain();setBg();setCard();setText();
}
</script>
</body>
</html>
