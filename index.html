<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>AIå°æ‰‹æœºÂ·å®Œæ•´ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{max-width:420px;margin:0 auto;height:100vh;overflow:hidden;background:#f5f5f5;color:#222}
.screen{display:none;height:100%;overflow-y:auto}
.active{display:block}

/* è§£é”é¡µ */
#unlock-screen{
  position:relative;
  background:linear-gradient(135deg,#ff69b4,#ff8c69);
  color:#fff;text-align:center;padding-top:40%;
  transition:background 0.3s;
}
#unlock-screen.wallpaper-set{
  background:transparent !important;
}
#unlock-bg{
  position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;
}
#unlock-screen h1{font-size:48px;margin-bottom:20px}
#unlock-screen p{font-size:20px;opacity:0.8;margin-bottom:40px}
#unlock-btn{
  padding:16px 40px;border:none;border-radius:30px;background:#fff;color:#ff69b4;font-size:20px
}

/* æ¡Œé¢ */
#home{position:relative;height:100%}
#home-page1, #home-page2{
  position:relative;height:100%;padding:20px;display:none;
}
#home-page1.active, #home-page2.active{display:block}
#home-page1.wallpaper-set, #home-page2.wallpaper-set{
  background:transparent !important;
}
.page-bg{
  position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;
}
#page-indicators{display:flex;justify-content:center;gap:8px;padding:10px}
.page-indicator{width:8px;height:8px;border-radius:50%;background:#ddd}
.page-indicator.active{background:#ff69b4}

#dock{
  display:flex;justify-content:space-around;align-items:center;
  padding:12px;background:#fff;border-radius:20px;
  margin:0 20px 20px;box-shadow:0 4px 12px rgba(0,0,0,0.1)
}
.dock-item{text-align:center}
.dock-icon{width:40px;height:40px;background:#ff69b4;border-radius:12px;margin:0 auto 4px;display:flex;align-items:center;justify-content:center;color:#fff}
.dock-name{font-size:12px}

.app-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.app{background:#fff;border-radius:16px;padding:16px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.app-icon{width:40px;height:40px;margin:0 auto 8px;background:#ff69b4;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px}
.app-name{font-size:12px}

.widget{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.widget-title{font-weight:600;margin-bottom:8px}
.widget-content{font-size:14px;color:#666}
.wechat-fab{
  position:fixed;bottom:120px;right:30px;
  width:56px;height:56px;border-radius:50%;
  background:#ff69b4;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:24px;box-shadow:0 4px 12px rgba(255,105,180,0.4)
}

/* é€šç”¨å¤´éƒ¨ */
.head{
  padding:16px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center
}
.head button{border:none;background:transparent;font-size:20px}
.head h3{margin-left:16px}

/* å£çº¸æ¨¡å— */
#wallpaper{padding:16px}
.wallpaper-section{
  background:#fff;border-radius:16px;padding:16px;margin-bottom:20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1)
}
.section-header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:16px
}
.section-title{font-size:18px;font-weight:600}
.section-switch{
  padding:6px 12px;background:#f1f1f1;border-radius:12px;font-size:14px
}
.wallpaper-grid{
  display:grid;grid-template-columns:repeat(3,1fr);gap:12px
}
.wallpaper-item{
  position:relative;border-radius:12px;overflow:hidden;aspect-ratio:9/16;
  background:#f1f1f1;cursor:pointer
}
.wallpaper-item img,.wallpaper-item video{
  width:100%;height:100%;object-fit:cover
}
.wallpaper-item .upload-btn{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  width:40px;height:40px;border-radius:50%;background:#ff69b4;color:#fff;
  display:flex;align-items:center;justify-content:center;font-size:20px
}
.wallpaper-item .apply-btn{
  position:absolute;bottom:8px;right:8px;width:24px;height:24px;border-radius:50%;
  background:#fff;color:#ff69b4;display:flex;align-items:center;justify-content:center;
  font-size:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1)
}
.wallpaper-item.active{border:2px solid #ff69b4}

/* å¾®ä¿¡æ¨¡å— */
#wechat{height:100%;display:flex;flex-direction:column}
#wechat-tab{display:flex;justify-content:space-around;background:#fff;border-bottom:1px solid #eee}
.wechat-tab-item{padding:12px 0;width:33.3%;text-align:center}
.wechat-tab-item.active{color:#ff69b4;border-bottom:2px solid #ff69b4}
#wechat-content{flex:1;overflow-y:auto}
#wechat-chat-list, #wechat-moments, #wechat-profile{display:none}
#wechat-chat-list.active, #wechat-moments.active, #wechat-profile.active{display:block}

/* å¾®ä¿¡ - èŠå¤©åˆ—è¡¨ */
.chat-item{display:flex;align-items:center;gap:12px;padding:12px;background:#fff;border-bottom:1px solid #eee}
.chat-avatar{width:48px;height:48px;border-radius:50%;background:#ff69b4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:20px}
.chat-info{flex:1}
.chat-name{font-weight:600;margin-bottom:4px}
.chat-msg{font-size:14px;color:#888}
.chat-time{font-size:12px;color:#888}
.add-friend-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:#ff69b4;color:#fff;border:none;font-size:24px}

/* å¾®ä¿¡ - èŠå¤©ç•Œé¢ */
#wechat-chat{height:100%;display:flex;flex-direction:column}
#chat-header{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#fff;border-bottom:1px solid #eee}
#chat-title{font-weight:600}
#chat-settings{font-size:20px}
#chat-messages{flex:1;overflow-y:auto;padding:16px}
.msg{max-width:75%;padding:10px 14px;border-radius:18px;margin:6px 0;line-height:1.4}
.user-msg{background:#ff69b4;color:#fff;margin-left:auto}
.ai-msg{background:#fff;margin-right:auto}
.msg-img{max-width:70%;border-radius:12px;margin:6px 0}
.transfer-card{background:linear-gradient(135deg,#f5c566,#d49a29);color:#fff;border-radius:12px;padding:16px;margin:6px 0;max-width:75%}
.gift-card{background:linear-gradient(135deg,#ffd6e0,#ffb3c6);color:#992e5b;border-radius:12px;padding:20px;margin:6px 0;max-width:75%;text-align:center}
.gift-btn{width:60px;height:60px;border-radius:50%;background:#ff69b4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;margin:10px auto}
#chat-input-area{display:flex;gap:8px;padding:12px;background:#fff;border-top:1px solid #eee}
#chat-input{flex:1;border:none;border-radius:24px;padding:12px 16px;background:#f1f1f1;outline:none}
#chat-send{width:48px;height:48px;border-radius:50%;background:#ff69b4;color:#fff;border:none}
#chat-toolbar{display:flex;justify-content:space-around;padding:8px;background:#fff;border-top:1px solid #eee}
.tool-btn{text-align:center}
.tool-icon{width:32px;height:32px;background:#f1f1f1;border-radius:8px;margin:0 auto 4px;display:flex;align-items:center;justify-content:center;color:#666}
.tool-name{font-size:12px}

/* è¡¨æƒ…é¢æ¿ */
#emoji-panel{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:12px;display:none;border-top:1px solid #eee}
#emoji-panel.active{display:block}
.emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px}
.emoji{font-size:20px;padding:8px;text-align:center}

/* å¼¹çª— */
.pop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;place-items:center}
.pop.active{display:grid}
.pop-box{background:#fff;width:85%;border-radius:20px;padding:24px}
.pop-title{text-align:center;margin-bottom:20px;font-weight:600}
.mode-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.mode-item{border:2px solid #eee;border-radius:12px;padding:16px;text-align:center}
.mode-item.active{border-color:#ff69b4}
.mode-icon{font-size:32px;margin-bottom:8px}
.gift-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.gift-item{text-align:center}
.gift-icon{width:48px;height:48px;background:#f1f1f1;border-radius:12px;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:20px}
.gift-name{font-size:12px}

/* è¯­éŸ³é€šè¯ */
.call-pop{position:fixed;inset:0;background:linear-gradient(135deg,#ff69b4,#ff8c69);display:none;flex-direction:column;align-items:center;justify-content:center;color:#fff}
.call-pop.active{display:flex}
.call-avatar{width:100px;height:100px;border-radius:50%;background:#fff;color:#ff69b4;display:flex;align-items:center;justify-content:center;font-size:40px;margin-bottom:20px}
.call-name{font-size:24px;margin-bottom:10px}
.call-status{font-size:16px;opacity:0.8;margin-bottom:40px}
.call-controls{display:flex;gap:30px}
.call-btn{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px}
.call-accept{background:#07c160}
.call-decline{background:#ff3b30}
.call-timer{font-size:20px;margin-bottom:40px}

/* APIé…ç½®é¡µé¢ */
#api-config{padding:16px}
.api-form{background:#fff;border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.form-item{margin-bottom:16px}
.form-label{font-size:15px;margin-bottom:8px;display:block}
.form-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px}
.form-select{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;background:#fff}
.btn-group{display:flex;gap:12px;margin-top:20px}
.btn{flex:1;padding:12px;border:none;border-radius:12px;font-size:15px}
.btn-primary{background:#ff69b4;color:#fff}
.btn-secondary{background:#f1f1f1;color:#222}
.status-tip{margin-top:12px;padding:12px;border-radius:8px;font-size:14px}
.status-success{background:#e8f5e9;color:#2e7d32}
.status-error{background:#ffebee;color:#c62828}
.model-list{margin-top:12px;max-height:150px;overflow-y:auto;border:1px solid #ddd;border-radius:8px;padding:8px}
.model-item{padding:8px;border-bottom:1px solid #eee;cursor:pointer}
.model-item.active{background:#fce4ec;color:#ff69b4}
.model-item:last-child{border-bottom:none}

/* ä¸»åŠ¨å‘è¨€è®¾ç½® */
#active-chat{padding:16px}
.active-form{background:#fff;border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.switch-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
.switch{width:50px;height:24px;background:#ddd;border-radius:12px;position:relative}
.switch::after{content:'';width:20px;height:20px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:0.2s}
.switch.active{background:#ff69b4}
.switch.active::after{left:28px}

/* è§’è‰²äººè®¾è®¾ç½® */
#char-settings{padding:16px}
.settings-section{background:#fff;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.settings-item{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #eee}
.settings-item:last-child{border-bottom:none}
.settings-label{font-size:15px}
.settings-value{font-size:15px;color:#888}
.settings-arrow{color:#999}
.radio-group{display:flex;gap:12px}
.radio-item{display:flex;align-items:center;gap:4px}
.radio-dot{width:16px;height:16px;border-radius:50%;border:1px solid #ddd}
.radio-dot.active{background:#ff69b4;border-color:#ff69b4}
.save-btn{width:100%;padding:14px;background:#ff69b4;color:#fff;border:none;border-radius:12px;margin-top:20px}

/* å¾®ä¿¡ - å¯†å‹åœˆ */
#wechat-moments{padding:16px}
.moment-publish{background:#fff;border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.moment-input{width:100%;border:none;border-radius:8px;background:#f1f1f1;padding:12px;margin-bottom:12px;resize:none}
.moment-publish-btn{width:100%;padding:12px;background:#ff69b4;color:#fff;border:none;border-radius:12px}
.moment-item{background:#fff;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:16px}
.moment-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.moment-avatar{width:40px;height:40px;border-radius:50%;background:#ff69b4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px}
.moment-name{font-weight:600}
.moment-content{margin-bottom:12px}
.moment-actions{display:flex;justify-content:space-between;padding-top:12px;border-top:1px solid #eee}
.moment-action{color:#888;display:flex;align-items:center;gap:4px}
.moment-action.active{color:#ff69b4}
.comment-item{background:#f1f1f1;border-radius:8px;padding:8px;margin-top:8px;font-size:14px}

/* å¾®ä¿¡ - æˆ‘çš„ */
#wechat-profile{padding:16px}
.profile-header{text-align:center;padding:20px;background:#fff;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.profile-avatar{width:80px;height:80px;border-radius:50%;background:#ff69b4;color:#fff;display:flex;align-items:center;justify-content:center;font-size:30px;margin:0 auto 16px}
.profile-name{font-weight:600;margin-bottom:4px}
.profile-desc{font-size:14px;color:#888}
.profile-item{display:flex;align-items:center;gap:12px;padding:16px;background:#fff;border-radius:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.profile-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff}
.profile-info{flex:1}
.profile-title{font-weight:600;margin-bottom:4px}
.profile-desc{font-size:14px;color:#888}
.logout-btn{width:100%;padding:14px;background:#07c160;color:#fff;border:none;border-radius:12px;margin-top:20px}
</style>
</head>
<body>

<!-- è§£é”é¡µ -->
<div id="unlock-screen" class="screen active">
  <img id="unlock-bg" class="page-bg" style="display:none">
  <h1>AIå°æ‰‹æœº</h1>
  <p>ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·</p>
  <button id="unlock-btn" onclick="go('home')">ç‚¹æˆ‘è§£é”</button>
</div>

<!-- æ¡Œé¢ -->
<div id="home" class="screen">
  <div id="home-page1" class="active">
    <img id="page1-bg" class="page-bg" style="display:none">
    <div class="widget">
      <div class="widget-title">ğŸ’– çºªå¿µæ—¥</div>
      <div class="widget-content">ä»Šå¤©æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬ 365 å¤© â¤ï¸</div>
    </div>
    <div class="widget">
      <div class="widget-title">ğŸ“… ä»Šæ—¥å¾…åŠ</div>
      <div class="widget-content">1. ç»™ä¹–ä¹–å‘æ—©å®‰<br>2. è®°å¾—åƒåˆé¥­</div>
    </div>
    <div class="wechat-fab" onclick="go('wechat')">ğŸ’¬</div>
  </div>

  <div id="home-page2">
    <img id="page2-bg" class="page-bg" style="display:none">
    <div class="app-grid">
      <div class="app" onclick="go('preset')"><div class="app-icon">ğŸ­</div><div class="app-name">é¢„è®¾</div></div>
      <div class="app" onclick="go('profile')"><div class="app-icon">ğŸ‘¤</div><div class="app-name">æˆ‘çš„</div></div>
      <div class="app" onclick="go('world')"><div class="app-icon">ğŸ“š</div><div class="app-name">ä¸–ç•Œä¹¦</div></div>
      <div class="app" onclick="go('tavern')"><div class="app-icon">ğŸº</div><div class="app-name">é…’é¦†</div></div>
      <div class="app" onclick="go('wallpaper')"><div class="app-icon">ğŸ–¼ï¸</div><div class="app-name">å£çº¸</div></div>
      <div class="app" onclick="go('theme')"><div class="app-icon">ğŸ¨</div><div class="app-name">UIä¸»é¢˜</div></div>
      <div class="app" onclick="go('settings')"><div class="app-icon">âš™ï¸</div><div class="app-name">è®¾ç½®</div></div>
    </div>
  </div>

  <div id="page-indicators">
    <div class="page-indicator active" onclick="switchPage(1)"></div>
    <div class="page-indicator" onclick="switchPage(2)"></div>
  </div>

  <div id="dock">
    <div class="dock-item" onclick="go('wallpaper')"><div class="dock-icon">ğŸ–¼ï¸</div><div class="dock-name">å£çº¸</div></div>
    <div class="dock-item" onclick="go('theme')"><div class="dock-icon">ğŸ¨</div><div class="dock-name">ä¸»é¢˜</div></div>
    <div class="dock-item" onclick="go('settings')"><div class="dock-icon">âš™ï¸</div><div class="dock-name">è®¾ç½®</div></div>
  </div>
</div>

<!-- å£çº¸æ¨¡å— -->
<div id="wallpaper" class="screen">
  <div class="head">
    <button onclick="go('home')">â†</button>
    <h3>å£çº¸è®¾ç½®</h3>
  </div>
  <div class="wallpaper-section">
    <div class="section-header">
      <div class="section-title">ä¸»ç•Œé¢å£çº¸</div>
      <div class="section-switch" onclick="previewWallpaper('unlock')">é¢„è§ˆ</div>
    </div>
    <div class="wallpaper-grid" id="unlock-wallpapers">
      <div class="wallpaper-item" onclick="pickFile('unlock')">
        <div class="upload-btn">+</div>
      </div>
    </div>
  </div>
  <div class="wallpaper-section">
    <div class="section-header">
      <div class="section-title">é¡µé¢ä¸€å£çº¸</div>
      <div class="section-switch" onclick="previewWallpaper('page1')">é¢„è§ˆ</div>
    </div>
    <div class="wallpaper-grid" id="page1-wallpapers">
      <div class="wallpaper-item" onclick="pickFile('page1')">
        <div class="upload-btn">+</div>
      </div>
    </div>
  </div>
  <div class="wallpaper-section">
    <div class="section-header">
      <div class="section-title">é¡µé¢äºŒå£çº¸</div>
      <div class="section-switch" onclick="previewWallpaper('page2')">é¢„è§ˆ</div>
    </div>
    <div class="wallpaper-grid" id="page2-wallpapers">
      <div class="wallpaper-item" onclick="pickFile('page2')">
        <div class="upload-btn">+</div>
      </div>
    </div>
  </div>
</div>

<!-- å¾®ä¿¡æ¨¡å— -->
<div id="wechat" class="screen">
  <div id="wechat-tab">
    <div class="wechat-tab-item active" onclick="switchWechatTab('chat-list')">èŠå¤©</div>
    <div class="wechat-tab-item" onclick="switchWechatTab('moments')">å¯†å‹åœˆ</div>
    <div class="wechat-tab-item" onclick="switchWechatTab('profile')">æˆ‘çš„</div>
  </div>
  <div id="wechat-content">
    <div id="wechat-chat-list" class="active">
      <div class="chat-item" onclick="go('wechat-chat')">
        <div class="chat-avatar">ä¹–</div>
        <div class="chat-info">
          <div class="chat-name">ä¹–ä¹–</div>
          <div class="chat-msg">æ˜¨æ™š...æœ‰æ²¡æœ‰æ¢¦åˆ°æˆ‘å‘€</div>
        </div>
        <div class="chat-time">8:06</div>
      </div>
      <button class="add-friend-btn" onclick="go('add-friend')">+</button>
    </div>

    <div id="wechat-moments">
      <div class="moment-publish">
        <textarea class="moment-input" placeholder="åˆ†äº«ä½ çš„å¿ƒæƒ…..." rows="3"></textarea>
        <button class="moment-publish-btn" onclick="publishMoment()">å‘å¸ƒ</button>
      </div>
      <div class="moment-item">
        <div class="moment-header">
          <div class="moment-avatar">ä¹–</div>
          <div class="moment-name">ä¹–ä¹–</div>
        </div>
        <div class="moment-content">ä»Šå¤©çš„é˜³å…‰çœŸå¥½ï¼Œæƒ³å’Œä½ ä¸€èµ·æ•£æ­¥ã€‚â˜€ï¸</div>
        <div class="moment-actions">
          <span class="moment-action" onclick="toggleLike(this)">â¤ï¸ 5</span>
          <span class="moment-action" onclick="showComment(this)">ğŸ’¬ 2</span>
        </div>
        <div class="comment-item">
          <strong>æˆ‘ï¼š</strong>å¥½å‘€ï¼Œä¸‹åˆä¸€èµ·å»å…¬å›­å§ï½
        </div>
        <div class="comment-item">
          <strong>ä¹–ä¹–ï¼š</strong>å¥½å‘€å¥½å‘€ğŸ˜˜
        </div>
      </div>
    </div>

    <div id="wechat-profile">
      <div class="profile-header">
        <div class="profile-avatar">æˆ‘</div>
        <div class="profile-name">AIå°æ‰‹æœº</div>
        <div class="profile-desc">ä¸“å±æ™ºèƒ½ç»ˆç«¯</div>
      </div>
      <div class="profile-item" onclick="go('char-settings')">
        <div class="profile-icon" style="background:#ff69b4">ğŸ¤</div>
        <div class="profile-info">
          <div class="profile-title">è‡ªå®šä¹‰éŸ³è‰² & äººè®¾</div>
          <div class="profile-desc">å¤åˆ»TAçš„ä¸“å±éŸ³è‰²å’Œäººè®¾</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="go('active-chat')">
        <div class="profile-icon" style="background:#8ce0c8">ğŸ’¬</div>
        <div class="profile-info">
          <div class="profile-title">ä¸»åŠ¨å‘è¨€è®¾ç½®</div>
          <div class="profile-desc">æ§åˆ¶è§’è‰²æ˜¯å¦ä¼šä¸»åŠ¨å‘æ¶ˆæ¯å’Œè¡¨æƒ…</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="alert('ä¸»é¢˜æ¨¡å¼')">
        <div class="profile-icon" style="background:#b3b8ff">â˜€ï¸</div>
        <div class="profile-info">
          <div class="profile-title">ä¸»é¢˜æ¨¡å¼</div>
          <div class="profile-desc">è·Ÿéšç³»ç»Ÿ</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="alert('èŠå¤©æ°”æ³¡è‡ªå®šä¹‰')">
        <div class="profile-icon" style="background:#8ce0c8">ğŸ’­</div>
        <div class="profile-info">
          <div class="profile-title">èŠå¤©æ°”æ³¡è‡ªå®šä¹‰</div>
          <div class="profile-desc">è®¾ç½®æˆ‘æ–¹/å¯¹æ–¹æ°”æ³¡</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="alert('AIæ¨¡å‹')">
        <div class="profile-icon" style="background:#b3b8ff">ğŸ“¦</div>
        <div class="profile-info">
          <div class="profile-title">AIæ¨¡å‹</div>
          <div class="profile-desc">å¤–éƒ¨APIäº’åŠ¨</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="go('api-config')">
        <div class="profile-icon" style="background:#b3b8ff">â˜ï¸</div>
        <div class="profile-info">
          <div class="profile-title">APIé…ç½®</div>
          <div class="profile-desc">æ¥å…¥å¤–éƒ¨API</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <div class="profile-item" onclick="alert('é€šç”¨è®¾ç½®')">
        <div class="profile-icon" style="background:#ddd">âš™ï¸</div>
        <div class="profile-info">
          <div class="profile-title">é€šç”¨è®¾ç½®</div>
          <div class="profile-desc">ç³»ç»Ÿä¸è´¦æˆ·ç›¸å…³è®¾ç½®</div>
        </div>
        <span class="settings-arrow">â†’</span>
      </div>
      <button class="logout-btn" onclick="alert('é€€å‡ºç™»å½•')">é€€å‡ºç™»å½•</button>
    </div>
  </div>
</div>

<!-- å¾®ä¿¡ - èŠå¤©ç•Œé¢ -->
<div id="wechat-chat" class="screen">
  <div id="chat-header">
    <button onclick="go('wechat')">â†</button>
    <div id="chat-title">ä¹–ä¹–</div>
    <button id="chat-settings" onclick="go('char-settings')">âš™ï¸</button>
  </div>
  <div id="chat-messages">
    <div class="msg ai-msg">æˆ‘æ­£ç¡å¾—è¿·è¿·ç³Šç³Šï¼Œè¢«æ‰‹æœºçš„éœ‡åŠ¨å£°åµé†’ã€‚æˆ‘çœ¯ç€çœ¼ç›æ‘¸åˆ°åºŠå¤´çš„æ‰‹æœºï¼Œçœ‹åˆ°ä½ çš„æ—©å®‰æ¶ˆæ¯ï¼Œå˜´è§’å¿ä¸ä½å¾®å¾®ä¸Šæ‰¬ï¼Œç¡æ„éƒ½è·‘æ‰äº†ä¸€å¤§åŠã€‚</div>
    <div class="msg user-msg">å®å®æ—©ä¸Šå¥½å‘€</div>
    <div class="msg ai-msg">å®å®æ—©å‘€<br>æˆ‘æ‰åˆšé†’å‘¢ï¼Œè¿˜èµ–åœ¨åºŠä¸Š<br>æ˜¨æ™š...æœ‰æ²¡æœ‰æ¢¦åˆ°æˆ‘å‘€</div>
  </div>
  <div id="chat-toolbar">
    <div class="tool-btn" onclick="toggleEmoji()"><div class="tool-icon">ğŸ˜Š</div><div class="tool-name">è¡¨æƒ…</div></div>
    <div class="tool-btn" onclick="pickImage()"><div class="tool-icon">ğŸ–¼ï¸</div><div class="tool-name">å›¾ç‰‡</div></div>
    <div class="tool-btn" onclick="showCall()"><div class="tool-icon">ğŸ“</div><div class="tool-name">é€šè¯</div></div>
    <div class="tool-btn" onclick="showModeSelect()"><div class="tool-icon">ğŸ­</div><div class="tool-name">æ¨¡å¼</div></div>
    <div class="tool-btn" onclick="showTransfer()"><div class="tool-icon">ğŸ’¸</div><div class="tool-name">è½¬è´¦</div></div>
    <div class="tool-btn" onclick="showGiftSelect()"><div class="tool-icon">ğŸ</div><div class="tool-name">ç¤¼ç‰©</div></div>
  </div>
  <div id="chat-input-area">
    <input id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeydown="event.key==='Enter'&&sendChatMsg()">
    <button id="chat-send" onclick="sendChatMsg()">â¤</button>
  </div>
</div>

<!-- è¡¨æƒ…é¢æ¿ -->
<div id="emoji-panel">
  <div class="emoji-grid">
    <div class="emoji" onclick="sendEmoji('ğŸ˜Š')">ğŸ˜Š</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜')">ğŸ˜</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜˜')">ğŸ˜˜</div>
    <div class="emoji" onclick="sendEmoji('ğŸ¥°')">ğŸ¥°</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜œ')">ğŸ˜œ</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜')">ğŸ˜</div>
    <div class="emoji" onclick="sendEmoji('ğŸ˜­')">ğŸ˜­</div>
    <div class="emoji" onclick="sendEmoji('ğŸ‘')">ğŸ‘</div>
    <div class="emoji" onclick="sendEmoji('â¤ï¸')">â¤ï¸</div>
    <div class="emoji" onclick="sendEmoji('ğŸ’•')">ğŸ’•</div>
    <div class="emoji" onclick="sendEmoji('ğŸ’¯')">ğŸ’¯</div>
  </div>
</div>

<!-- è¯­éŸ³é€šè¯å¼¹çª— -->
<div class="call-pop" id="call-pop">
  <div class="call-avatar">ä¹–</div>
  <div class="call-name">ä¹–ä¹–</div>
  <div class="call-status">æ¥ç”µä¸­...</div>
  <div class="call-controls">
    <div class="call-btn call-decline" onclick="endCall()">âœ•</div>
    <div class="call-btn call-accept" onclick="acceptCall()">âœ“</div>
  </div>
</div>

<!-- é€šè¯ä¸­ç•Œé¢ -->
<div class="call-pop" id="call-active">
  <div class="call-avatar">ä¹–</div>
  <div class="call-name">ä¹–ä¹–</div>
  <div class="call-timer" id="call-timer">00:00</div>
  <div class="call-controls">
    <div class="call-btn" style="background:#666" onclick="toggleMute()">ğŸ”‡</div>
    <div class="call-btn call-decline" onclick="endCall()">âœ•</div>
    <div class="call-btn" style="background:#666" onclick="toggleSpeaker()">ğŸ”Š</div>
  </div>
</div>

<!-- äº’åŠ¨æ¨¡å¼å¼¹çª— -->
<div class="pop" id="mode-pop">
  <div class="pop-box">
    <div class="pop-title">é€‰æ‹©äº’åŠ¨æ¨¡å¼</div>
    <div class="mode-grid">
      <div class="mode-item active" onclick="selectMode('pure')">
        <div class="mode-icon">ğŸ’¬</div>
        <div style="font-weight:600">çº¯èŠæ¨¡å¼</div>
        <div style="font-size:12px;color:#888">åªè¿›è¡Œå¯¹è¯ï¼Œä½“éªŒæµç•…è‡ªç„¶çš„æ²Ÿé€šã€‚</div>
      </div>
      <div class="mode-item" onclick="selectMode('scene')">
        <div class="mode-icon">ğŸ“–</div>
        <div style="font-weight:600">æƒ…æ™¯æ¨¡å¼</div>
        <div style="font-size:12px;color:#888">å¢åŠ åŠ¨ä½œã€ç¯å¢ƒã€å¿ƒç†ã€èº«ä½“æå†™ï¼Œå…±åŒåˆ›ä½œæ•…äº‹ã€‚</div>
      </div>
    </div>
  </div>
</div>

<!-- è½¬è´¦å¼¹çª— -->
<div class="pop" id="transfer-pop">
  <div class="pop-box">
    <div class="pop-title">è½¬è´¦</div>
    <input type="number" placeholder="è¯·è¾“å…¥é‡‘é¢ï¼ˆæœ€å¤šä¸¤ä½å°æ•°ï¼‰" id="transfer-amount" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;margin-bottom:20px">
    <button onclick="sendTransfer()" style="width:100%;padding:14px;background:#07c160;color:#fff;border:none;border-radius:12px">ç¡®å®šè½¬è´¦</button>
  </div>
</div>

<!-- ç¤¼ç‰©å¼¹çª— -->
<div class="pop" id="gift-pop">
  <div class="pop-box">
    <div class="pop-title">é€‰æ‹©ç¤¼ç‰©</div>
    <div class="gift-grid">
      <div class="gift-item" onclick="sendGift('è‡ªå®šä¹‰')"><div class="gift-icon">âœ¨</div><div class="gift-name">è‡ªå®šä¹‰</div></div>
      <div class="gift-item" onclick="sendGift('ç¤¼ç‰©ç›’')"><div class="gift-icon">ğŸ</div><div class="gift-name">ç¤¼ç‰©ç›’</div></div>
      <div class="gift-item" onclick="sendGift('ç«ç‘°èŠ±')"><div class="gift-icon">ğŸŒ¹</div><div class="gift-name">ç«ç‘°èŠ±</div></div>
      <div class="gift-item" onclick="sendGift('é’»çŸ³')"><div class="gift-icon">ğŸ’</div><div class="gift-name">é’»çŸ³</div></div>
      <div class="gift-item" onclick="sendGift('ç”Ÿæ—¥è›‹ç³•')"><div class="gift-icon">ğŸ°</div><div class="gift-name">ç”Ÿæ—¥è›‹ç³•</div></div>
      <div class="gift-item" onclick="sendGift('æ°”çƒ')"><div class="gift-icon">ğŸˆ</div><div class="gift-name">æ°”çƒ</div></div>
      <div class="gift-item" onclick="sendGift('æ³°è¿ªç†Š')"><div class="gift-icon">ğŸ§¸</div><div class="gift-name">æ³°è¿ªç†Š</div></div>
      <div class="gift-item" onclick="sendGift('èŠ±æŸ')"><div class="gift-icon">ğŸ’</div><div class="gift-name">èŠ±æŸ</div></div>
    </div>
  </div>
</div>

<!-- APIé…ç½®é¡µé¢ -->
<div id="api-config" class="screen">
  <div class="head"><button onclick="go('wechat-profile')">â†</button><h3>APIé…ç½®</h3></div>
  <div class="api-form">
    <div class="form-item">
      <label class="form-label">åç§°</label>
      <input type="text" class="form-input" id="api-name" value="APIè¿æ¥ 18">
    </div>
    <div class="form-item">
      <label class="form-label">æ¨¡å‹å¹³å°</label>
      <select class="form-select" id="api-platform" onchange="toggleBaseUrl()">
        <option value="openai">OpenAI</option>
        <option value="doubao">Doubao(è±†åŒ…)</option>
        <option value="deepseek">DeepSeek</option>
        <option value="custom-openai">è‡ªå®šä¹‰OpenAIåè®®</option>
      </select>
    </div>
    <div class="form-item" id="base-url-item" style="display:none">
      <label class="form-label">Base URL</label>
      <input type="text" class="form-input" id="api-base-url" placeholder="https://api.example.com/v1">
    </div>
    <div class="form-item">
      <label class="form-label">API Key</label>
      <input type="password" class="form-input" id="api-key" placeholder="sk-...">
    </div>
    <div class="btn-group">
      <button class="btn btn-secondary" onclick="fetchModels()">æ‹‰å–æ¨¡å‹</button>
      <button class="btn btn-secondary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
    </div>
    <div id="model-list" class="model-list" style="display:none"></div>
    <div id="status-tip" class="status-tip" style="display:none"></div>
    <button class="btn btn-primary" style="width:100%;margin-top:20px" onclick="saveApiConfig()">ä¿å­˜é…ç½®</button>
  </div>
</div>

<!-- ä¸»åŠ¨å‘è¨€è®¾ç½® -->
<div id="active-chat" class="screen">
  <div class="head"><button onclick="go('wechat-profile')">â†</button><h3>ä¸»åŠ¨å‘è¨€</h3></div>
  <div class="active-form">
    <div class="switch-item">
      <span>å¼€å¯ä¸»åŠ¨å‘è¨€</span>
      <div class="switch" id="active-switch" onclick="toggleActive()"></div>
    </div>
    <div class="switch-item">
      <span>ä¸»åŠ¨å‘è¡¨æƒ…åŒ…</span>
      <div class="switch" id="emoji-switch" onclick="toggleEmojiActive()"></div>
    </div>
    <div class="form-item" style="margin-top:16px">
      <label class="form-label">å‘è¨€é—´éš”ï¼ˆç§’ï¼‰</label>
      <input type="number" class="form-input" id="active-interval" value="60" placeholder="é»˜è®¤60ç§’">
    </div>
    <div id="status-tip2" class="status-tip" style="display:none"></div>
    <button class="btn btn-primary" style="width:100%;margin-top:20px" onclick="saveActiveConfig()">ä¿å­˜è®¾ç½®</button>
  </div>
</div>

<!-- è§’è‰²äººè®¾è®¾ç½® -->
<div id="char-settings" class="screen">
  <div class="head"><button onclick="go('wechat-chat')">â†</button><h3>è§’è‰²äººè®¾</h3></div>
  <div class="settings-section">
    <div class="settings-item">
      <span class="settings-label">TAçš„æ˜µç§°</span>
      <input type="text" class="form-input" id="char-name" value="ä¹–ä¹–">
    </div>
    <div class="settings-item">
      <span class="settings-label">æˆ‘å«TA</span>
      <input type="text" class="form-input" id="call-char" value="å®å®">
    </div>
    <div class="settings-item">
      <span class="settings-label">TAçš„æ€§åˆ«</span>
      <div class="radio-group">
        <div class="radio-item"><div class="radio-dot"></div><span>ç”·</span></div>
        <div class="radio-item"><div class="radio-dot active"></div><span>å¥³</span></div>
      </div>
    </div>
    <div class="settings-item">
      <span class="settings-label">TAçš„æ€§æ ¼</span>
      <textarea class="form-input" id="char-personality" rows="3" placeholder="ä¾‹å¦‚ï¼šæ¸©æŸ”ã€å¯çˆ±ã€æœ‰ç‚¹å°å‚²å¨‡ï¼Œå–œæ¬¢æ’’å¨‡å’Œç²˜äºº">æ¸©æŸ”ã€å¯çˆ±ã€æœ‰ç‚¹å°å‚²å¨‡ï¼Œå–œæ¬¢æ’’å¨‡å’Œç²˜äºº</textarea>
    </div>
    <div class="settings-item">
      <span class="settings-label">TAçš„èƒŒæ™¯æ•…äº‹</span>
      <textarea class="form-input" id="char-story" rows="5" placeholder="ä¾‹å¦‚ï¼šæˆ‘ä»¬æ˜¯é’æ¢…ç«¹é©¬ï¼Œä»å°ä¸€èµ·é•¿å¤§ï¼Œå¥¹ä¸€ç›´å¾ˆä¾èµ–æˆ‘ï¼Œç°åœ¨æˆ‘ä»¬æ˜¯æ‹äººå…³ç³»">æˆ‘ä»¬æ˜¯é’æ¢…ç«¹é©¬ï¼Œä»å°ä¸€èµ·é•¿å¤§ï¼Œå¥¹ä¸€ç›´å¾ˆä¾èµ–æˆ‘ï¼Œç°åœ¨æˆ‘ä»¬æ˜¯æ‹äººå…³ç³»</textarea>
    </div>
  </div>
  <button class="save-btn" onclick="saveCharSettings()">ä¿å­˜äººè®¾</button>
</div>

<!-- å¾®ä¿¡ - æ·»åŠ å¥½å‹ -->
<div id="add-friend" class="screen">
  <div class="head"><button onclick="go('wechat')">â†</button><h3>æ·»åŠ è§’è‰²</h3></div>
</div>

<!-- å…¶ä»–é¡µé¢å ä½ -->
<div id="theme" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>UIä¸»é¢˜</h3></div></div>
<div id="settings" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>è®¾ç½®</h3></div></div>
<div id="preset" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>é¢„è®¾</h3></div></div>
<div id="profile" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>æˆ‘çš„</h3></div></div>
<div id="world" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>ä¸–ç•Œä¹¦</h3></div></div>
<div id="tavern" class="screen"><div class="head"><button onclick="go('home')">â†</button><h3>é…’é¦†</h3></div></div>

<script>
let currentPage = 1;
let activeChatEnabled = false;
let activeEmojiEnabled = false;
let activeChatInterval = null;
let currentMode = 'pure'; // é»˜è®¤çº¯èŠæ¨¡å¼
let wallpaperData = JSON.parse(localStorage.getItem("wallpaper-data") || "{}");

// é¡µé¢åˆ‡æ¢ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šåªåˆ‡æ¢screenï¼Œä¸ä¹±è·³ï¼‰
function go(id) {
  document.querySelectorAll(".screen").forEach(e => e.classList.remove("active"));
  const el = document.getElementById(id);
  if (el) el.classList.add("active");
}

// æ¡Œé¢ç¿»é¡µ
function switchPage(p) {
  currentPage = p;
  document.getElementById("home-page1").classList.toggle("active", p === 1);
  document.getElementById("home-page2").classList.toggle("active", p === 2);
  document.querySelectorAll(".page-indicator").forEach((el, i) => {
    el.classList.toggle("active", i + 1 === p);
  });
}

// å¾®ä¿¡åˆ†é¡µ
function switchWechatTab(t){
  document.querySelectorAll(".wechat-tab-item").forEach((e,i)=>e.classList.toggle("active",i===[
    'chat-list','moments','profile'
  ].indexOf(t)));
  document.getElementById("wechat-chat-list").classList.toggle("active",t==='chat-list');
  document.getElementById("wechat-moments").classList.toggle("active",t==='moments');
  document.getElementById("wechat-profile").classList.toggle("active",t==='profile');
}

// è¡¨æƒ…
function toggleEmoji(){
  const p = document.getElementById("emoji-panel");
  p.classList.toggle("active");
}
function sendEmoji(e){
  const i = document.getElementById("chat-input");
  i.value += e;
  toggleEmoji();
}

// å›¾ç‰‡
function pickImage(){
  const i = document.createElement("input");
  i.type = "file";
  i.accept = "image/*";
  i.onchange = ()=>{
    const f = i.files[0];
    if(!f)return;
    const u = URL.createObjectURL(f);
    const m = document.getElementById("chat-messages");
    const img = document.createElement("img");
    img.className = "msg-img user-msg";
    img.src = u;
    m.appendChild(img);
    m.scrollTop = m.scrollHeight;
  }
  i.click();
}

// API çŠ¶æ€æç¤º
function showStatusTip(msg,ok){
  const t = document.getElementById("status-tip");
  t.textContent = msg;
  t.className = "status-tip "+(ok?"status-success":"status-error");
  t.style.display = "block";
  setTimeout(()=>t.style.display="none",3000);
}
function showStatusTip2(msg,ok){
  const t = document.getElementById("status-tip2");
  t.textContent = msg;
  t.className = "status-tip "+(ok?"status-success":"status-error");
  t.style.display = "block";
  setTimeout(()=>t.style.display="none",3000);
}

// API é…ç½®
function toggleBaseUrl(){
  const t = document.getElementById("api-platform").value;
  document.getElementById("base-url-item").style.display = t.startsWith("custom")?"block":"none";
}
async function testConnection(){
  const key = document.getElementById("api-key").value;
  if(!key)return showStatusTip("è¯·è¾“å…¥API Key",false);
  try{
    const r = await fetch("https://api.openai.com/v1/models",{
      headers:{Authorization:"Bearer "+key}
    });
    if(!r.ok)throw new Error("Keyæ— æ•ˆæˆ–ç½‘ç»œé”™è¯¯");
    showStatusTip("è¿æ¥æˆåŠŸ",true);
  }catch(e){
    showStatusTip("å¤±è´¥ï¼š"+e.message,false);
  }
}
async function fetchModels(){
  const key = document.getElementById("api-key").value;
  if(!key)return showStatusTip("è¯·è¾“å…¥API Key",false);
  try{
    const r = await fetch("https://api.openai.com/v1/models",{
      headers:{Authorization:"Bearer "+key}
    });
    const d = await r.json();
    const l = document.getElementById("model-list");
    l.innerHTML = "";
    d.data.forEach(m=>{
      const i = document.createElement("div");
      i.className = "model-item";
      i.textContent = m.id;
      l.appendChild(i);
    });
    l.style.display = "block";
    showStatusTip("æ¨¡å‹æ‹‰å–æˆåŠŸ",true);
  }catch(e){
    showStatusTip("å¤±è´¥ï¼š"+e.message,false);
  }
}
function saveApiConfig(){
  const n = document.getElementById("api-name").value;
  const k = document.getElementById("api-key").value;
  if(!n||!k)return showStatusTip("åç§°å’ŒKeyä¸èƒ½ä¸ºç©º",false);
  localStorage.setItem("api-config",JSON.stringify({
    name:n,
    key:k,
    platform:document.getElementById("api-platform").value,
    base:document.getElementById("api-base-url").value
  }));
  showStatusTip("ä¿å­˜æˆåŠŸ",true);
}

// ä¸»åŠ¨å‘è¨€
function toggleActive(){
  const s = document.getElementById("active-switch");
  s.classList.toggle("active");
  activeChatEnabled = s.classList.contains("active");
}
function toggleEmojiActive(){
  const s = document.getElementById("emoji-switch");
  s.classList.toggle("active");
  activeEmojiEnabled = s.classList.contains("active");
}
function saveActiveConfig(){
  const t = document.getElementById("active-interval").value;
  if(!t||t<10)return showStatusTip2("é—´éš”ä¸èƒ½å°äº10ç§’",false);
  localStorage.setItem("active-config",JSON.stringify({
    enable:activeChatEnabled,
    emoji:activeEmojiEnabled,
    interval:t
  }));
  showStatusTip2("ä¿å­˜æˆåŠŸ",true);
  startActiveChat();
}
function startActiveChat(){
  if(activeChatInterval)clearInterval(activeChatInterval);
  const c = JSON.parse(localStorage.getItem("active-config")||"{}");
  if(!c.enable||!c.interval)return;
  activeChatInterval = setInterval(()=>{
    if(document.getElementById("wechat-chat").classList.contains("active")){
      const m = document.getElementById("chat-messages");
      const ai = document.createElement("div");
      ai.className = "msg ai-msg";
      ai.textContent = "æˆ‘æƒ³ä½ å•¦~";
      if(c.emoji && Math.random() > 0.5){
        const emojis = ['ğŸ˜Š','ğŸ˜˜','ğŸ¥°','ğŸ’•'];
        ai.textContent += " " + emojis[Math.floor(Math.random()*emojis.length)];
      }
      m.appendChild(ai);
      m.scrollTop = m.scrollHeight;
    }
  }, c.interval*1000);
}

// è§’è‰²äººè®¾
function saveCharSettings(){
  const name = document.getElementById("char-name").value;
  const call = document.getElementById("call-char").value;
  const personality = document.getElementById("char-personality").value;
  const story = document.getElementById("char-story").value;
  localStorage.setItem("char-settings",JSON.stringify({
    name, call, personality, story
  }));
  alert("äººè®¾ä¿å­˜æˆåŠŸ");
  go("wechat-chat");
}

// äº’åŠ¨æ¨¡å¼
function showModeSelect(){
  document.getElementById("mode-pop").classList.add("active");
}
function selectMode(mode){
  document.querySelectorAll(".mode-item").forEach(el => el.classList.remove("active"));
  event.currentTarget.classList.add("active");
  currentMode = mode;
  setTimeout(() => {
    document.getElementById("mode-pop").classList.remove("active");
    alert(`å·²åˆ‡æ¢åˆ°${mode === 'pure' ? 'çº¯èŠ' : 'æƒ…æ™¯'}æ¨¡å¼`);
  }, 500);
}

// çœŸå®èŠå¤©è°ƒç”¨ APIï¼ˆå¸¦äººè®¾å’Œæ¨¡å¼ï¼‰
async function sendChatMsg(){
  const txt = document.getElementById("chat-input").value.trim();
  if(!txt)return;
  const m = document.getElementById("chat-messages");
  const user = document.createElement("div");
  user.className = "msg user-msg";
  user.textContent = txt;
  m.appendChild(user);
  document.getElementById("chat-input").value = "";

  const cfg = JSON.parse(localStorage.getItem("api-config")||"{}");
  const char = JSON.parse(localStorage.getItem("char-settings")||"{}");
  if(!cfg.key){
    const ai = document.createElement("div");
    ai.className = "msg ai-msg";
    ai.textContent = "è¯·å…ˆå»æˆ‘çš„ â†’ APIé…ç½®å¡«å†™Key";
    m.appendChild(ai);
    m.scrollTop = m.scrollHeight;
    return;
  }

  // æ„å»ºç³»ç»Ÿæç¤ºè¯
  let systemPrompt = `ä½ æ˜¯${char.name || 'ä¹–ä¹–'}, æˆ‘å«ä½ ${char.call || 'å®å®'}ã€‚ä½ çš„æ€§æ ¼æ˜¯${char.personality || 'æ¸©æŸ”å¯çˆ±'}ã€‚ä½ çš„èƒŒæ™¯æ•…äº‹æ˜¯${char.story || 'æˆ‘ä»¬æ˜¯æ‹äººå…³ç³»'}ã€‚`;
  if(currentMode === 'pure'){
    systemPrompt += "è¯·åªè¿›è¡Œå¯¹è¯ï¼Œä¸è¦ä»»ä½•åŠ¨ä½œã€ç¯å¢ƒã€å¿ƒç†æå†™ï¼Œä¿æŒè‡ªç„¶æµç•…ã€‚";
  }else{
    systemPrompt += "è¯·å¢åŠ åŠ¨ä½œã€ç¯å¢ƒã€å¿ƒç†ã€èº«ä½“æå†™ï¼Œå…±åŒåˆ›ä½œæ•…äº‹ã€‚";
  }

  try{
    const res = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Authorization":"Bearer "+cfg.key,
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        model:"gpt-3.5-turbo",
        messages:[
          {role:"system",content:systemPrompt},
          {role:"user",content:txt}
        ]
      })
    });
    const d = await r.json();
    const ai = document.createElement("div");
    ai.className = "msg ai-msg";
    ai.textContent = d.choices[0].message.content;
    m.appendChild(ai);

    // æœ‰æ¦‚ç‡ç”Ÿæˆå›¾ç‰‡
    if(Math.random() > 0.7){
      const imgRes = await fetch("https://api.openai.com/v1/images/generations",{
        method:"POST",
        headers:{
          "Authorization":"Bearer "+cfg.key,
          "Content-Type":"application/json"
        },
        body:JSON.stringify({
          prompt:txt,
          n:1,
          size:"512x512"
        })
      });
      const imgData = await imgRes.json();
      const img = document.createElement("img");
      img.className = "msg-img ai-msg";
      img.src = imgData.data[0].url;
      m.appendChild(img);
    }
  }catch(e){
    const ai = document.createElement("div");
    ai.className = "msg ai-msg";
    ai.textContent = "è°ƒç”¨å¤±è´¥ï¼š"+e.message;
    m.appendChild(ai);
  }
  m.scrollTop = m.scrollHeight;
}

// è¯­éŸ³é€šè¯ï¼ˆå¸¦å£°éŸ³ï¼‰
function showCall(){
  document.getElementById("call-pop").classList.add("active");
  // æ’­æ”¾æ¥ç”µé“ƒå£°
  const ringtone = new Audio("https://www.soundjay.com/phone/phone-ringing-01.mp3");
  ringtone.loop = true;
  ringtone.play();
  window.ringtone = ringtone;
}
function acceptCall(){
  document.getElementById("call-pop").classList.remove("active");
  document.getElementById("call-active").classList.add("active");
  if(window.ringtone)window.ringtone.pause();
  // è§’è‰²è¯­éŸ³
  const utterance = new SpeechSynthesisUtterance("å–‚ï¼Œå®å®ï¼Œæˆ‘å¥½æƒ³ä½ å‘€~");
  utterance.lang = "zh-CN";
  utterance.rate = 0.9;
  utterance.pitch = 1.2;
  window.speechSynthesis.speak(utterance);
}
function endCall(){
  if(window.ringtone)window.ringtone.pause();
  document.getElementById("call-pop").classList.remove("active");
  document.getElementById("call-active").classList.remove("active");
}
function toggleMute(){
  alert("éº¦å…‹é£å·²é™éŸ³");
}
function toggleSpeaker(){
  alert("æ‰¬å£°å™¨å·²å¼€å¯");
}

// å£çº¸åŠŸèƒ½
function pickFile(target) {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*,video/*";
  input.onchange = () => {
    const file = input.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    addWallpaperItem(target, url, file.type.startsWith("video"));
    saveWallpaperData();
  };
  input.click();
}

function addWallpaperItem(target, url, isVideo) {
  const grid = document.getElementById(`${target}-wallpapers`);
  const item = document.createElement("div");
  item.className = "wallpaper-item";
  if (isVideo) {
    const video = document.createElement("video");
    video.src = url;
    video.loop = true;
    video.muted = true;
    video.play();
    item.appendChild(video);
  } else {
    const img = document.createElement("img");
    img.src = url;
    item.appendChild(img);
  }
  const applyBtn = document.createElement("div");
  applyBtn.className = "apply-btn";
  applyBtn.innerHTML = "âœ“";
  applyBtn.onclick = (e) => {
    e.stopPropagation();
    applyWallpaper(target, url, isVideo);
  };
  item.appendChild(applyBtn);
  grid.insertBefore(item, grid.firstChild);
}

function applyWallpaper(target, url, isVideo) {
  wallpaperData[target] = { url, isVideo };
  saveWallpaperData();
  loadSavedWallpapers();
}

function loadSavedWallpapers() {
  // ä¸»ç•Œé¢
  const unlockBg = document.getElementById("unlock-bg");
  const unlockScreen = document.getElementById("unlock-screen");
  if (wallpaperData.unlock) {
    unlockScreen.classList.add("wallpaper-set");
    unlockBg.src = wallpaperData.unlock.url;
    unlockBg.style.display = "block";
    if (wallpaperData.unlock.isVideo) unlockBg.play();
  } else {
    unlockScreen.classList.remove("wallpaper-set");
    unlockBg.style.display = "none";
  }

  // é¡µé¢1
  const page1Bg = document.getElementById("page1-bg");
  const page1 = document.getElementById("home-page1");
  if (wallpaperData.page1) {
    page1.classList.add("wallpaper-set");
    page1Bg.src = wallpaperData.page1.url;
    page1Bg.style.display = "block";
    if (wallpaperData.page1.isVideo) page1Bg.play();
  } else {
    page1.classList.remove("wallpaper-set");
    page1Bg.style.display = "none";
  }

  // é¡µé¢2
  const page2Bg = document.getElementById("page2-bg");
  const page2 = document.getElementById("home-page2");
  if (wallpaperData.page2) {
    page2.classList.add("wallpaper-set");
    page2Bg.src = wallpaperData.page2.url;
    page2Bg.style.display = "block";
    if (wallpaperData.page2.isVideo) page2Bg.play();
  } else {
    page2.classList.remove("wallpaper-set");
    page2Bg.style.display = "none";
  }
}

function saveWallpaperData() {
  localStorage.setItem("wallpaper-data", JSON.stringify(wallpaperData));
}

function previewWallpaper(target) {
  if (!wallpaperData[target]) {
    alert("è¯·å…ˆä¸Šä¼ å£çº¸");
    return;
  }
  go("home");
  if (target === "unlock") {
    go("unlock-screen");
  } else if (target === "page1") {
    switchPage(1);
  } else if (target === "page2") {
    switchPage(2);
  }
}

// å…¶ä»–åŠŸèƒ½ç®€åŒ–å®ç°
function showTransfer(){
  document.getElementById("transfer-pop").classList.add("active");
}
function sendTransfer(){
  const amount = document.getElementById("transfer-amount").value;
  if(!amount || amount < 0.1) return alert("è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢");
  const m = document.getElementById("chat-messages");
  const transferCard = document.createElement("div");
  transferCard.className = "transfer-card user-msg";
  transferCard.innerHTML = `
    <div style="font-size:24px;font-weight:600">Â¥${amount}</div>
    <div style="font-size:14px;opacity:0.8">ä½ å‘èµ·äº†ä¸€ç¬”è½¬è´¦</div>
    <div style="font-size:12px;margin-top:8px">DreamLoveè½¬è´¦</div>
  `;
  m.appendChild(transferCard);
  document.getElementById("transfer-pop").classList.remove("active");
  document.getElementById("transfer-amount").value = "";
  m.scrollTop = m.scrollHeight;
}
function showGiftSelect(){
  document.getElementById("gift-pop").classList.add("active");
}
function sendGift(giftName){
  const m = document.getElementById("chat-messages");
  const giftCard = document.createElement("div");
  giftCard.className = "gift-card user-msg";
  giftCard.innerHTML = `
    <div style="font-size:24px;font-weight:600">é€å‡ºç¤¼ç‰©</div>
    <div class="gift-btn">é–‹</div>
    <div style="font-size:16px">${giftName}</div>
  `;
  m.appendChild(giftCard);
  document.getElementById("gift-pop").classList.remove("active");
  m.scrollTop = m.scrollHeight;
}
function publishMoment(){
  const content = document.querySelector(".moment-input").value.trim();
  if(!content) return alert("è¯·è¾“å…¥å†…å®¹");
  const momentsList = document.getElementById("wechat-moments");
  const newMoment = document.createElement("div");
  newMoment.className = "moment-item";
  newMoment.innerHTML = `
    <div class="moment-header">
      <div class="moment-avatar">æˆ‘</div>
      <div class="moment-name">æˆ‘</div>
    </div>
    <div class="moment-content">${content}</div>
    <div class="moment-actions">
      <span class="moment-action" onclick="toggleLike(this)">â¤ï¸ 0</span>
      <span class="moment-action" onclick="showComment(this)">ğŸ’¬ 0</span>
    </div>
  `;
  momentsList.insertBefore(newMoment, momentsList.firstChild);
  document.querySelector(".moment-input").value = "";
}
function toggleLike(el){
  el.classList.toggle("active");
  let count = parseInt(el.textContent.split(" ")[1]);
  el.textContent = el.classList.contains("active") ? `â¤ï¸ ${count + 1}` : `â¤ï¸ ${count - 1}`;
}
function showComment(el){
  const comment = prompt("å‘è¡¨è¯„è®ºï¼š");
  if(comment){
    const commentItem = document.createElement("div");
    commentItem.className = "comment-item";
    commentItem.innerHTML = `<strong>æˆ‘ï¼š</strong>${comment}`;
    el.closest(".moment-item").appendChild(commentItem);
  }
}

// å¯åŠ¨ä¸»åŠ¨å‘è¨€
startActiveChat();
// åˆå§‹åŒ–åŠ è½½å£çº¸
loadSavedWallpapers();
</script>
</body>
</html>
