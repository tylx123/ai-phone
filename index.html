<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIå°æ‰‹æœº Â· é…’é¦†å®Œå…¨æ•´åˆç‰ˆ</title>
    <style>
        /* ========== å…¨å±€æ ·å¼ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            max-width: 420px;
            margin: 0 auto;
            height: 100vh;
            background: #f5f5f5;
            color: #222;
            overflow: hidden;
            position: relative;
        }

        .screen {
            display: none;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .screen.active {
            display: block;
        }

        /* é€šç”¨å¤´éƒ¨ */
        .head {
            padding: 16px;
            background: #fff;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .head button {
            background: none;
            border: none;
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #ff69b4;
        }
        .head h3 {
            margin-left: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        /* è§£é”å±å¹• */
        #unlock-screen {
            position: relative;
            background: linear-gradient(135deg, #ff69b4, #ff8c69);
            color: white;
            text-align: center;
            padding-top: 40%;
        }
        #unlock-screen.wallpaper-set {
            background: transparent !important;
        }
        #unlock-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        #unlock-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        #unlock-screen p {
            font-size: 20px;
            opacity: 0.9;
            margin-bottom: 40px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        #unlock-btn, #unlock-back-btn {
            padding: 16px 40px;
            border: none;
            border-radius: 30px;
            background: white;
            color: #ff69b4;
            font-size: 20px;
            margin: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-weight: 600;
        }
        #unlock-back-btn {
            background: rgba(255,255,255,0.3);
            color: white;
            backdrop-filter: blur(5px);
        }

        /* æ¡Œé¢ */
        #home {
            position: relative;
            height: 100%;
            background: #fff;
        }
        #home-page1, #home-page2 {
            position: relative;
            height: 100%;
            padding: 20px;
            display: none;
            overflow-y: auto;
        }
        #home-page1.active, #home-page2.active {
            display: block;
        }
        #home-page1.wallpaper-set, #home-page2.wallpaper-set {
            background: transparent !important;
        }
        .page-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        #page-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
            position: absolute;
            bottom: 90px;
            left: 0;
            right: 0;
            z-index: 5;
        }
        .page-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ddd;
        }
        .page-indicator.active {
            background: #ff69b4;
        }

        #dock {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            margin: 0 20px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            z-index: 10;
        }
        .dock-item {
            text-align: center;
            cursor: pointer;
            flex: 1;
        }
        .dock-icon {
            width: 44px;
            height: 44px;
            background: #ff69b4;
            border-radius: 12px;
            margin: 0 auto 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        .dock-name {
            font-size: 11px;
            color: #333;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }
        .app {
            background: white;
            border-radius: 16px;
            padding: 16px 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .app:active {
            transform: scale(0.95);
        }
        .app-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 8px;
            background: #ff69b4;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        .app-name {
            font-size: 11px;
            color: #333;
        }

        /* å¾®ä¿¡æ¨¡å— (AIå°æ‰‹æœºçš„æ ¸å¿ƒ) */
        #wechat {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }
        #wechat-tab {
            display: flex;
            justify-content: space-around;
            background: white;
            border-bottom: 1px solid #eee;
        }
        .wechat-tab-item {
            padding: 12px 0;
            width: 33.33%;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
        }
        .wechat-tab-item.active {
            color: #ff69b4;
            border-bottom: 2px solid #ff69b4;
        }
        #wechat-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        #wechat-chat-list, #wechat-moments, #wechat-profile {
            display: none;
        }
        #wechat-chat-list.active, #wechat-moments.active, #wechat-profile.active {
            display: block;
        }

        /* èŠå¤©åˆ—è¡¨é¡¹ */
        .chat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #ff69b4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
        }
        .chat-info {
            flex: 1;
        }
        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .chat-msg {
            font-size: 13px;
            color: #888;
        }
        .chat-time {
            font-size: 11px;
            color: #aaa;
        }

        /* èŠå¤©ç•Œé¢ */
        #wechat-chat {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #e5ddd5;
        }
        #chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #ff69b4;
            color: white;
        }
        #chat-header button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        #chat-title {
            font-weight: 600;
            font-size: 18px;
        }
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }
        .message {
            max-width: 75%;
            padding: 10px 14px;
            border-radius: 18px;
            margin: 4px 0;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .message.user {
            background: #ff69b4;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .message.ai {
            background: white;
            color: #222;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .message-img {
            max-width: 70%;
            border-radius: 12px;
            margin: 6px 0;
            align-self: flex-start;
        }
        .transfer-card, .gift-card {
            max-width: 75%;
            border-radius: 12px;
            padding: 16px;
            margin: 6px 0;
            color: white;
            align-self: flex-start;
        }
        .transfer-card {
            background: linear-gradient(135deg, #f5c566, #d49a29);
        }
        .gift-card {
            background: linear-gradient(135deg, #ffd6e0, #ffb3c6);
            color: #992e5b;
            text-align: center;
        }
        .gift-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ff69b4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 10px auto;
        }
        #chat-input-area {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: #f0f0f0;
            border-top: 1px solid #ddd;
        }
        #chat-input {
            flex: 1;
            border: none;
            border-radius: 24px;
            padding: 12px 16px;
            background: white;
            outline: none;
            font-size: 14px;
        }
        #chat-send {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #ff69b4;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 20px;
        }
        #chat-toolbar {
            display: flex;
            justify-content: space-around;
            padding: 8px;
            background: white;
            border-top: 1px solid #eee;
        }
        .tool-btn {
            text-align: center;
            cursor: pointer;
        }
        .tool-icon {
            width: 36px;
            height: 36px;
            background: #f1f1f1;
            border-radius: 8px;
            margin: 0 auto 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
        }
        .tool-name {
            font-size: 10px;
        }

        /* è¡¨æƒ…é¢æ¿ */
        #emoji-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            display: none;
            border-top: 1px solid #eee;
            z-index: 200;
            max-width: 420px;
            margin: 0 auto;
        }
        #emoji-panel.active {
            display: block;
        }
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
        }
        .emoji {
            font-size: 24px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
        }

        /* å£çº¸æ¨¡å— */
        #wallpaper {
            padding: 16px;
        }
        .wallpaper-section {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
        }
        .section-switch {
            padding: 6px 12px;
            background: #f1f1f1;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
        }
        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .wallpaper-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 9/16;
            background: #f1f1f1;
            cursor: pointer;
        }
        .wallpaper-item img, .wallpaper-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .wallpaper-item .upload-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ff69b4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .wallpaper-item .apply-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            color: #ff69b4;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .wallpaper-item.active {
            border: 2px solid #ff69b4;
        }

        /* é…’é¦†æ¨¡å— (æ‰€æœ‰Tavernç›¸å…³ç•Œé¢) */
        .tavern-screen {
            background: #1a1a2e;
            color: #eee;
        }
        .tavern-head {
            background: #16213e;
            border-bottom: 1px solid #0f3460;
            color: white;
        }
        .tavern-head button {
            color: #a6d0fa;
        }
        .tavern-card {
            background: #16213e;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 16px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tavern-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #a6d0fa;
        }
        .tavern-btn {
            background: #0f3460;
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin: 4px;
        }
        .tavern-input {
            background: #0f3460;
            border: 1px solid #1a4d8c;
            color: white;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 10px;
        }
        .tavern-list-item {
            background: #0f3460;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tavern-switch {
            width: 40px;
            height: 20px;
            background: #555;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
        }
        .tavern-switch.active {
            background: #a6d0fa;
        }
        .tavern-switch::after {
            content: '';
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 1px;
            left: 1px;
            transition: 0.2s;
        }
        .tavern-switch.active::after {
            left: 21px;
        }

        /* é€šç”¨å¼¹çª— */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            width: 85%;
            max-width: 350px;
            border-radius: 20px;
            padding: 24px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }
        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: #f1f1f1;
            cursor: pointer;
        }
        .modal-btn.primary {
            background: #ff69b4;
            color: white;
        }
    </style>
</head>
<body>
    <!-- è§£é”å±å¹• -->
    <div id="unlock-screen" class="screen active">
        <img id="unlock-bg" src="" style="display: none;">
        <h1>ğŸ¤– AIå°æ‰‹æœº</h1>
        <p>æ»‘åŠ¨è§£é” Â· é…’é¦†å·²æ•´åˆ</p>
        <button id="unlock-btn">è§£é”</button>
        <button id="unlock-back-btn" style="display: none;">è¿”å›æ¡Œé¢</button>
    </div>

    <!-- ä¸»æ¡Œé¢ -->
    <div id="home" class="screen">
        <!-- å£çº¸å›¾ç‰‡ (åŠ¨æ€è®¾ç½®) -->
        <img id="home-bg1" class="page-bg" src="" style="display: none;">
        <img id="home-bg2" class="page-bg" src="" style="display: none;">

        <!-- ç¬¬ä¸€é¡µ -->
        <div id="home-page1" class="active">
            <div class="app-grid">
                <div class="app" onclick="showScreen('wechat')">
                    <div class="app-icon">ğŸ’¬</div>
                    <div class="app-name">å¾®ä¿¡</div>
                </div>
                <div class="app" onclick="showScreen('contacts')">
                    <div class="app-icon">ğŸ‘¥</div>
                    <div class="app-name">é€šè®¯å½•</div>
                </div>
                <div class="app" onclick="showScreen('moments')">
                    <div class="app-icon">ğŸŒ…</div>
                    <div class="app-name">å¯†å‹åœˆ</div>
                </div>
                <div class="app" onclick="showScreen('settings')">
                    <div class="app-icon">âš™ï¸</div>
                    <div class="app-name">è®¾ç½®</div>
                </div>
                <div class="app" onclick="showScreen('wallpaper')">
                    <div class="app-icon">ğŸ–¼ï¸</div>
                    <div class="app-name">å£çº¸</div>
                </div>
                <div class="app" onclick="showScreen('active-chat')">
                    <div class="app-icon">â°</div>
                    <div class="app-name">ä¸»åŠ¨å‘è¨€</div>
                </div>
                <div class="app" onclick="showScreen('profile')">
                    <div class="app-icon">ğŸ‘¤</div>
                    <div class="app-name">ä¸ªäººèµ„æ–™</div>
                </div>
                <div class="app" onclick="showScreen('call')">
                    <div class="app-icon">ğŸ“</div>
                    <div class="app-name">é€šè¯</div>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒé¡µ (åŒ…å«é…’é¦†å…¥å£) -->
        <div id="home-page2">
            <div class="app-grid">
                <div class="app" onclick="TavernShowScreen('tavern-home')">
                    <div class="app-icon">ğŸº</div>
                    <div class="app-name">é…’é¦†</div>
                </div>
                <div class="app" onclick="showScreen('tools')">
                    <div class="app-icon">ğŸ”§</div>
                    <div class="app-name">å·¥å…·</div>
                </div>
                <div class="app" onclick="showScreen('files')">
                    <div class="app-icon">ğŸ“</div>
                    <div class="app-name">æ–‡ä»¶</div>
                </div>
                <div class="app" onclick="showScreen('backup')">
                    <div class="app-icon">ğŸ’¾</div>
                    <div class="app-name">å¤‡ä»½</div>
                </div>
                <!-- æ›´å¤šå ä½ -->
                <div class="app" onclick="showScreen('help')">
                    <div class="app-icon">â“</div>
                    <div class="app-name">å¸®åŠ©</div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
        <div id="page-indicators">
            <span class="page-indicator active" onclick="switchHomePage(0)"></span>
            <span class="page-indicator" onclick="switchHomePage(1)"></span>
        </div>

        <!-- åº•éƒ¨Dock -->
        <div id="dock">
            <div class="dock-item" onclick="switchHomePage(0)">
                <div class="dock-icon">ğŸ </div>
                <div class="dock-name">ä¸»é¡µ</div>
            </div>
            <div class="dock-item" onclick="switchHomePage(1)">
                <div class="dock-icon">ğŸº</div>
                <div class="dock-name">é…’é¦†</div>
            </div>
            <div class="dock-item" onclick="showScreen('wechat')">
                <div class="dock-icon">ğŸ’¬</div>
                <div class="dock-name">å¾®ä¿¡</div>
            </div>
            <div class="dock-item" onclick="showScreen('settings')">
                <div class="dock-icon">âš™ï¸</div>
                <div class="dock-name">è®¾ç½®</div>
            </div>
        </div>
    </div>

    <!-- ========== AIå°æ‰‹æœº åŠŸèƒ½ç•Œé¢ ========== -->
    <!-- å¾®ä¿¡ä¸»ç•Œé¢ -->
    <div id="wechat" class="screen">
        <div id="wechat-tab">
            <div class="wechat-tab-item active" data-tab="chat">èŠå¤©</div>
            <div class="wechat-tab-item" data-tab="moments">å¯†å‹åœˆ</div>
            <div class="wechat-tab-item" data-tab="profile">æˆ‘çš„</div>
        </div>
        <div id="wechat-content">
            <!-- èŠå¤©åˆ—è¡¨ -->
            <div id="wechat-chat-list" class="active">
                <div class="chat-item" onclick="enterChat('å°è‰¾')">
                    <div class="chat-avatar">ğŸ¤–</div>
                    <div class="chat-info">
                        <div class="chat-name">å°è‰¾</div>
                        <div class="chat-msg">ä»Šå¤©å¤©æ°”çœŸå¥½</div>
                    </div>
                    <div class="chat-time">åˆšåˆš</div>
                </div>
                <div class="chat-item" onclick="enterChat('é…’é¦†åŠ©æ‰‹')">
                    <div class="chat-avatar">ğŸº</div>
                    <div class="chat-info">
                        <div class="chat-name">é…’é¦†åŠ©æ‰‹</div>
                        <div class="chat-msg">æœ‰æ–°è§’è‰²å¡ arrived</div>
                    </div>
                    <div class="chat-time">æ˜¨å¤©</div>
                </div>
            </div>
            <!-- å¯†å‹åœˆ -->
            <div id="wechat-moments">
                <div style="text-align: center; padding: 30px;">æš‚æ— æ–°åŠ¨æ€</div>
            </div>
            <!-- ä¸ªäººèµ„æ–™ -->
            <div id="wechat-profile">
                <div style="text-align: center; padding: 30px;">ç”¨æˆ·èµ„æ–™å¡</div>
            </div>
        </div>
        <div class="wechat-fab" onclick="showAddFriendModal()">+</div>
    </div>

    <!-- èŠå¤©ç•Œé¢ (åŠ¨æ€è¿›å…¥) -->
    <div id="wechat-chat" class="screen">
        <div id="chat-header">
            <button onclick="goBackFromChat()">â†</button>
            <span id="chat-title">å°è‰¾</span>
            <button onclick="showChatSettings()">â‹¯</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input-area">
            <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
            <button id="chat-send" onclick="sendMessage()">â¤</button>
        </div>
        <div id="chat-toolbar">
            <div class="tool-btn" onclick="showEmojiPanel()">
                <div class="tool-icon">ğŸ˜Š</div>
                <div class="tool-name">è¡¨æƒ…</div>
            </div>
            <div class="tool-btn" onclick="sendTransfer()">
                <div class="tool-icon">ğŸ’°</div>
                <div class="tool-name">è½¬è´¦</div>
            </div>
            <div class="tool-btn" onclick="sendGift()">
                <div class="tool-icon">ğŸ</div>
                <div class="tool-name">ç¤¼ç‰©</div>
            </div>
            <div class="tool-btn" onclick="takePhoto()">
                <div class="tool-icon">ğŸ“·</div>
                <div class="tool-name">æ‹ç…§</div>
            </div>
        </div>
    </div>

    <!-- è¡¨æƒ…é¢æ¿ -->
    <div id="emoji-panel">
        <div class="emoji-grid">
            <span class="emoji" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
            <span class="emoji" onclick="insertEmoji('ğŸ¥º')">ğŸ¥º</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‰')">ğŸ‰</span>
            <span class="emoji" onclick="insertEmoji('â¤ï¸')">â¤ï¸</span>
        </div>
    </div>

    <!-- å£çº¸è®¾ç½®ç•Œé¢ -->
    <div id="wallpaper" class="screen">
        <div class="head">
            <button onclick="showScreen('home')">â†</button>
            <h3>å£çº¸è®¾ç½®</h3>
        </div>
        <div class="wallpaper-section">
            <div class="section-header">
                <span class="section-title">é™æ€å£çº¸</span>
                <span class="section-switch" onclick="applyToAll()">åº”ç”¨åˆ°å…¨éƒ¨</span>
            </div>
            <div class="wallpaper-grid">
                <div class="wallpaper-item" onclick="selectWallpaper('img', 'https://picsum.photos/400/800?random=1')">
                    <img src="https://picsum.photos/400/800?random=1">
                    <span class="apply-btn">âœ“</span>
                </div>
                <div class="wallpaper-item" onclick="selectWallpaper('img', 'https://picsum.photos/400/800?random=2')">
                    <img src="https://picsum.photos/400/800?random=2">
                    <span class="apply-btn">âœ“</span>
                </div>
                <div class="wallpaper-item" onclick="selectWallpaper('img', 'https://picsum.photos/400/800?random=3')">
                    <img src="https://picsum.photos/400/800?random=3">
                    <span class="apply-btn">âœ“</span>
                </div>
                <div class="wallpaper-item">
                    <div class="upload-btn" onclick="uploadWallpaper()">ğŸ“¤</div>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®ç•Œé¢ (ç®€åŒ–) -->
    <div id="settings" class="screen">
        <div class="head">
            <button onclick="showScreen('home')">â†</button>
            <h3>è®¾ç½®</h3>
        </div>
        <div style="padding: 16px;">
            <div class="wallpaper-section">
                <div class="section-header">
                    <span class="section-title">API é…ç½®</span>
                </div>
                <select id="api-platform" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px;">
                    <option value="openai">OpenAI</option>
                    <option value="deepseek">DeepSeek</option>
                    <option value="doubao">è±†åŒ…</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
                <input type="text" id="api-key" class="tavern-input" placeholder="API Key" style="background:white; color:black;">
                <input type="text" id="api-url" class="tavern-input" placeholder="API URL (å¯é€‰)" style="background:white; color:black;">
                <button class="tavern-btn" onclick="testAPIConnection()">æµ‹è¯•è¿æ¥</button>
                <button class="tavern-btn" onclick="saveAPISettings()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- å…¶ä»–å ä½ç•Œé¢ (ä¸ºå®Œæ•´è€Œè®¾) -->
    <div id="contacts" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>é€šè®¯å½•</h3></div><div style="padding:20px">é€šè®¯å½•å†…å®¹</div></div>
    <div id="moments" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>å¯†å‹åœˆ</h3></div><div style="padding:20px">åŠ¨æ€åˆ—è¡¨</div></div>
    <div id="active-chat" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>ä¸»åŠ¨å‘è¨€</h3></div><div style="padding:20px">è®¾ç½®ä¸»åŠ¨å‘è¨€å‚æ•°</div></div>
    <div id="profile" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>ä¸ªäººèµ„æ–™</h3></div><div style="padding:20px">èµ„æ–™å¡</div></div>
    <div id="call" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>é€šè¯</h3></div><div style="padding:20px">é€šè¯ç•Œé¢</div></div>
    <div id="tools" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>å·¥å…·</h3></div><div style="padding:20px">å·¥å…·ç®±</div></div>
    <div id="files" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>æ–‡ä»¶ç®¡ç†</h3></div><div style="padding:20px">æ–‡ä»¶åˆ—è¡¨</div></div>
    <div id="backup" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>å¤‡ä»½</h3></div><div style="padding:20px">å¤‡ä»½ä¸æ¢å¤</div></div>
    <div id="help" class="screen"><div class="head"><button onclick="showScreen('home')">â†</button><h3>å¸®åŠ©</h3></div><div style="padding:20px">å¸®åŠ©æ–‡æ¡£</div></div>

    <!-- ========== é…’é¦†æ¨¡å— æ‰€æœ‰ç•Œé¢ ========== -->
    <!-- é…’é¦†ä¸»é¡µ -->
    <div id="tavern-home" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="showScreen('home')">â†</button>
            <h3>ğŸº é…’é¦† Â· è§’è‰²æ‰®æ¼”</h3>
        </div>
        <div class="tavern-card">
            <div class="tavern-title">æ ¸å¿ƒåŠŸèƒ½</div>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-characters')">ğŸ“‡ è§’è‰²å¡</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-memories')">ğŸ§  é•¿æœŸè®°å¿†</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-world')">ğŸ“– ä¸–ç•Œä¹¦</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-regex')">ğŸ” æ­£åˆ™</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-presets')">âš™ï¸ é¢„è®¾</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-user')">ğŸ‘¤ ç”¨æˆ·è®¾å®š</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-api')">ğŸ”Œ APIé…ç½®</button>
            <button class="tavern-btn" onclick="TavernShowScreen('tavern-system')">ğŸ–¥ï¸ ç³»ç»Ÿè®¾ç½®</button>
        </div>
    </div>

    <!-- è§’è‰²å¡ç•Œé¢ -->
    <div id="tavern-characters" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>è§’è‰²å¡</h3>
        </div>
        <div class="tavern-card">
            <button class="tavern-btn" onclick="TavernImportCharacter()">ğŸ“¤ å¯¼å…¥PNGè§’è‰²å¡</button>
            <div id="tavern-character-list" style="margin-top:16px;">
                <!-- åŠ¨æ€åˆ—è¡¨ -->
                <div class="tavern-list-item">
                    <span>ğŸ¤– åŠ©æ‰‹å°èŒ</span>
                    <span style="display:flex;gap:8px;">
                        <span onclick="TavernEditCharacter('assistant')">âœï¸</span>
                        <span onclick="TavernDeleteCharacter('assistant')">ğŸ—‘ï¸</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- é•¿æœŸè®°å¿†ç•Œé¢ -->
    <div id="tavern-memories" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>é•¿æœŸè®°å¿†</h3>
        </div>
        <div class="tavern-card">
            <input type="text" class="tavern-input" placeholder="æœç´¢è®°å¿†...">
            <div style="display:flex; gap:8px; margin:10px 0;">
                <button class="tavern-btn" onclick="TavernAddMemory()">â• æ–°å¢</button>
                <button class="tavern-btn" onclick="TavernSortMemories()">â±ï¸ æŒ‰æ—¶é—´æ’åº</button>
            </div>
            <div id="tavern-memory-list">
                <div class="tavern-list-item">
                    <span>è®°å¿†1: å–œæ¬¢å–å’–å•¡</span>
                    <span onclick="TavernEditMemory(1)">âœï¸</span>
                </div>
                <div class="tavern-list-item">
                    <span>è®°å¿†2: å®³æ€•èœ˜è››</span>
                    <span onclick="TavernEditMemory(2)">âœï¸</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸–ç•Œä¹¦ç•Œé¢ -->
    <div id="tavern-world" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>ä¸–ç•Œä¹¦</h3>
        </div>
        <div class="tavern-card">
            <div class="tavern-list-item">
                <span>å¥‡å¹»å¤§é™†è®¾å®š</span>
                <div style="display:flex; gap:8px; align-items:center;">
                    <span class="tavern-switch active" onclick="TavernToggleWorld(this, 'fantasy')"></span>
                    <span onclick="TavernEditWorld('fantasy')">âœï¸</span>
                </div>
            </div>
            <div class="tavern-list-item">
                <span>æœªæ¥éƒ½å¸‚è®¾å®š</span>
                <div style="display:flex; gap:8px; align-items:center;">
                    <span class="tavern-switch" onclick="TavernToggleWorld(this, 'future')"></span>
                    <span onclick="TavernEditWorld('future')">âœï¸</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æ­£åˆ™ç•Œé¢ -->
    <div id="tavern-regex" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>æ­£åˆ™è¿‡æ»¤</h3>
        </div>
        <div class="tavern-card">
            <div class="tavern-list-item">
                <span>è¿‡æ»¤æ•æ„Ÿè¯</span>
                <span class="tavern-switch active" onclick="TavernToggleRegex(this, 'filter')"></span>
            </div>
            <div class="tavern-list-item">
                <span>æ›¿æ¢æ˜µç§°</span>
                <span class="tavern-switch" onclick="TavernToggleRegex(this, 'nickname')"></span>
            </div>
        </div>
    </div>

    <!-- é¢„è®¾ç•Œé¢ (å ä½) -->
    <div id="tavern-presets" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>é¢„è®¾</h3>
        </div>
        <div class="tavern-card">é¢„è®¾åˆ—è¡¨ (å¯æ‰©å±•)</div>
    </div>

    <!-- ç”¨æˆ·è®¾å®šç•Œé¢ (å ä½) -->
    <div id="tavern-user" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>ç”¨æˆ·è®¾å®š</h3>
        </div>
        <div class="tavern-card">ç”¨æˆ·èµ„æ–™ä¸åå¥½</div>
    </div>

    <!-- APIé…ç½®ç•Œé¢ (é…’é¦†ä¸“ç”¨) -->
    <div id="tavern-api" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>APIé…ç½®</h3>
        </div>
        <div class="tavern-card">
            <select id="tavern-api-platform" style="width:100%; padding:8px; margin-bottom:10px; border-radius:8px;">
                <option value="openai">OpenAI</option>
                <option value="deepseek">DeepSeek</option>
                <option value="doubao">è±†åŒ…</option>
                <option value="custom">è‡ªå®šä¹‰</option>
            </select>
            <input type="text" id="tavern-api-key" class="tavern-input" placeholder="API Key">
            <input type="text" id="tavern-api-url" class="tavern-input" placeholder="API URL (å¯é€‰)">
            <button class="tavern-btn" onclick="TavernTestConnection()">æµ‹è¯•è¿æ¥</button>
            <button class="tavern-btn" onclick="TavernSaveAPI()">ä¿å­˜</button>
        </div>
    </div>

    <!-- ç³»ç»Ÿè®¾ç½®ç•Œé¢ (å ä½) -->
    <div id="tavern-system" class="screen tavern-screen">
        <div class="head tavern-head">
            <button onclick="TavernShowScreen('tavern-home')">â†</button>
            <h3>ç³»ç»Ÿè®¾ç½®</h3>
        </div>
        <div class="tavern-card">ä¸»é¢˜ã€å¤‡ä»½ç­‰è®¾ç½®</div>
    </div>

    <!-- é€šç”¨çŠ¶æ€æç¤ºæµ®å±‚ (ç®€åŒ–) -->
    <div id="status-tip" style="position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:8px 20px; border-radius:40px; font-size:14px; display:none; z-index:3000;">æç¤º</div>

    <script>
        // ========== å…¨å±€å·¥å…·å‡½æ•° ==========
        function showStatusTip(msg, duration = 2000) {
            const tip = document.getElementById('status-tip');
            tip.textContent = msg;
            tip.style.display = 'block';
            setTimeout(() => { tip.style.display = 'none'; }, duration);
        }

        // å±å¹•åˆ‡æ¢ (AIæ‰‹æœºéƒ¨åˆ†)
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(screenId);
            if (target) target.classList.add('active');
            else showScreen('home'); // é»˜è®¤å›é¦–é¡µ
        }

        // è¿”å›æ¡Œé¢
        function goHome() {
            showScreen('home');
        }

        // æ¡Œé¢ç¿»é¡µ
        function switchHomePage(index) {
            document.getElementById('home-page1').classList.toggle('active', index === 0);
            document.getElementById('home-page2').classList.toggle('active', index === 1);
            document.querySelectorAll('.page-indicator').forEach((ind, i) => {
                ind.classList.toggle('active', i === index);
            });
        }

        // è§£é”åŠŸèƒ½
        document.getElementById('unlock-btn').addEventListener('click', () => {
            showScreen('home');
        });
        document.getElementById('unlock-back-btn').addEventListener('click', () => {
            showScreen('home');
        });

        // å¾®ä¿¡tabåˆ‡æ¢
        document.querySelectorAll('.wechat-tab-item').forEach(item => {
            item.addEventListener('click', (e) => {
                document.querySelectorAll('.wechat-tab-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                const tab = item.dataset.tab;
                document.getElementById('wechat-chat-list').classList.remove('active');
                document.getElementById('wechat-moments').classList.remove('active');
                document.getElementById('wechat-profile').classList.remove('active');
                if (tab === 'chat') document.getElementById('wechat-chat-list').classList.add('active');
                else if (tab === 'moments') document.getElementById('wechat-moments').classList.add('active');
                else if (tab === 'profile') document.getElementById('wechat-profile').classList.add('active');
            });
        });

        // è¿›å…¥èŠå¤©
        let currentChat = 'å°è‰¾';
        function enterChat(name) {
            currentChat = name;
            document.getElementById('chat-title').textContent = name;
            // éšè—wechatä¸»ç•Œé¢ï¼Œæ˜¾ç¤ºèŠå¤©ç•Œé¢
            document.getElementById('wechat').classList.remove('active');
            document.getElementById('wechat-chat').classList.add('active');
            // æ¸…ç©ºå¹¶åŠ å…¥æ¬¢è¿æ¶ˆæ¯
            const msgDiv = document.getElementById('chat-messages');
            msgDiv.innerHTML = '';
            addMessage(`å¼€å§‹å’Œ ${name} èŠå¤©å§`, 'ai');
        }

        function goBackFromChat() {
            document.getElementById('wechat-chat').classList.remove('active');
            document.getElementById('wechat').classList.add('active');
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(text, sender = 'user', isImage = false, isTransfer = false, isGift = false) {
            const msgDiv = document.getElementById('chat-messages');
            const msg = document.createElement('div');
            msg.classList.add('message', sender);
            if (isImage) {
                msg.classList.remove('message');
                msg.classList.add('message-img');
                msg.innerHTML = `<img src="${text}" style="width:100%; border-radius:12px;">`;
            } else if (isTransfer) {
                msg.classList.remove('message');
                msg.classList.add('transfer-card');
                msg.innerHTML = `<div style="font-weight:600;">è½¬è´¦ ğŸ’°</div><div>${text}</div>`;
            } else if (isGift) {
                msg.classList.remove('message');
                msg.classList.add('gift-card');
                msg.innerHTML = `<div class="gift-btn">ğŸ</div><div>${text}</div>`;
            } else {
                msg.textContent = text;
            }
            msgDiv.appendChild(msg);
            msgDiv.scrollTop = msgDiv.scrollHeight;
        }

        // å‘é€æ¶ˆæ¯ (æ¨¡æ‹ŸAIå›å¤)
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            addMessage(text, 'user');
            input.value = '';

            // æ¨¡æ‹ŸAIå›å¤ (å®é™…åº”è°ƒç”¨API)
            setTimeout(() => {
                addMessage('æ”¶åˆ°ä½ çš„æ¶ˆæ¯å•¦ï¼(æ¨¡æ‹Ÿå›å¤)', 'ai');
            }, 800);
        }

        // è¡¨æƒ…é¢æ¿
        function showEmojiPanel() {
            document.getElementById('emoji-panel').classList.add('active');
        }
        function insertEmoji(emoji) {
            const input = document.getElementById('chat-input');
            input.value += emoji;
            document.getElementById('emoji-panel').classList.remove('active');
            input.focus();
        }
        // ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­è¡¨æƒ…é¢æ¿ (ç®€å•å¤„ç†)
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#emoji-panel') && !e.target.closest('[onclick="showEmojiPanel()"]')) {
                document.getElementById('emoji-panel').classList.remove('active');
            }
        });

        // è½¬è´¦/ç¤¼ç‰©
        function sendTransfer() {
            addMessage('å‘ä½ è½¬è´¦ 52.0å…ƒ', 'user', false, true);
            setTimeout(() => addMessage('è°¢è°¢è€æ¿ï¼', 'ai'), 600);
        }
        function sendGift() {
            addMessage('é€ä½ ä¸€ä¸ªç¤¼ç‰©', 'user', false, false, true);
            setTimeout(() => addMessage('å“‡ï¼Œå¤ªæ¼‚äº®äº†ï¼', 'ai'), 600);
        }
        function takePhoto() {
            showStatusTip('æ‹ç…§åŠŸèƒ½å¼€å‘ä¸­');
        }
        function showChatSettings() {
            showStatusTip('èŠå¤©è®¾ç½®');
        }
        function showAddFriendModal() {
            showStatusTip('æ·»åŠ å¥½å‹');
        }

        // å£çº¸åŠŸèƒ½
        function selectWallpaper(type, src) {
            document.getElementById('unlock-bg').src = src;
            document.getElementById('unlock-bg').style.display = 'block';
            document.getElementById('unlock-screen').classList.add('wallpaper-set');
            document.getElementById('home-bg1').src = src;
            document.getElementById('home-bg1').style.display = 'block';
            document.getElementById('home-bg2').src = src;
            document.getElementById('home-bg2').style.display = 'block';
            document.getElementById('home-page1').classList.add('wallpaper-set');
            document.getElementById('home-page2').classList.add('wallpaper-set');
            showStatusTip('å£çº¸å·²åº”ç”¨');
        }
        function applyToAll() {
            // ç®€å•å¤ç”¨å½“å‰å£çº¸
            showStatusTip('å·²åº”ç”¨åˆ°æ‰€æœ‰å±å¹•');
        }
        function uploadWallpaper() {
            showStatusTip('ä¸Šä¼ åŠŸèƒ½å¾…å®ç°');
        }

        // APIè®¾ç½®ç›¸å…³
        function testAPIConnection() {
            const platform = document.getElementById('api-platform').value;
            const key = document.getElementById('api-key').value;
            const url = document.getElementById('api-url').value;
            showStatusTip(`æµ‹è¯•è¿æ¥: ${platform} ${key ? 'Keyå·²å¡«' : 'æ— Key'}`);
        }
        function saveAPISettings() {
            localStorage.setItem('AI_Phone_API', JSON.stringify({
                platform: document.getElementById('api-platform').value,
                key: document.getElementById('api-key').value,
                url: document.getElementById('api-url').value
            }));
            showStatusTip('APIè®¾ç½®å·²ä¿å­˜');
        }

        // ========== é…’é¦†æ¨¡å—å‡½æ•° (å‡ä»¥Tavernå¼€å¤´) ==========
        function TavernShowScreen(screenId) {
            // éšè—æ‰€æœ‰æ™®é€šå±å¹•
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(screenId);
            if (target) target.classList.add('active');
            else TavernShowScreen('tavern-home');
        }

        // å¯¼å…¥è§’è‰²å¡ (æ¨¡æ‹Ÿ)
        function TavernImportCharacter() {
            showStatusTip('è¯·é€‰æ‹©PNGè§’è‰²å¡æ–‡ä»¶ (æ¨¡æ‹Ÿ)');
        }

        function TavernEditCharacter(id) {
            showStatusTip(`ç¼–è¾‘è§’è‰² ${id}`);
        }
        function TavernDeleteCharacter(id) {
            showStatusTip(`åˆ é™¤è§’è‰² ${id}`);
        }

        // è®°å¿†ç®¡ç†
        function TavernAddMemory() {
            showStatusTip('æ–°å¢è®°å¿† (æ¨¡æ‹Ÿ)');
        }
        function TavernSortMemories() {
            showStatusTip('æŒ‰æ—¶é—´æ’åº');
        }
        function TavernEditMemory(id) {
            showStatusTip(`ç¼–è¾‘è®°å¿† ${id}`);
        }

        // ä¸–ç•Œä¹¦å¼€å…³
        function TavernToggleWorld(el, id) {
            el.classList.toggle('active');
            showStatusTip(`ä¸–ç•Œä¹¦ ${id} å·²${el.classList.contains('active')?'å¯ç”¨':'ç¦ç”¨'}`);
        }

        // æ­£åˆ™å¼€å…³
        function TavernToggleRegex(el, id) {
            el.classList.toggle('active');
            showStatusTip(`æ­£åˆ™ ${id} å·²${el.classList.contains('active')?'å¯ç”¨':'ç¦ç”¨'}`);
        }

        // é…’é¦†APIæµ‹è¯•
        function TavernTestConnection() {
            const platform = document.getElementById('tavern-api-platform').value;
            const key = document.getElementById('tavern-api-key').value;
            const url = document.getElementById('tavern-api-url').value;
            showStatusTip(`é…’é¦†APIæµ‹è¯•: ${platform} ${key ? 'Keyå·²å¡«' : 'æ— Key'}`);
        }

        function TavernSaveAPI() {
            localStorage.setItem('Tavern_API', JSON.stringify({
                platform: document.getElementById('tavern-api-platform').value,
                key: document.getElementById('tavern-api-key').value,
                url: document.getElementById('tavern-api-url').value
            }));
            showStatusTip('é…’é¦†APIè®¾ç½®å·²ä¿å­˜');
        }

        // å…¶ä»–é…’é¦†å‡½æ•°å ä½
        window.TavernShowScreen = TavernShowScreen;
        window.TavernImportCharacter = TavernImportCharacter;
        window.TavernEditCharacter = TavernEditCharacter;
        window.TavernDeleteCharacter = TavernDeleteCharacter;
        window.TavernAddMemory = TavernAddMemory;
        window.TavernSortMemories = TavernSortMemories;
        window.TavernEditMemory = TavernEditMemory;
        window.TavernToggleWorld = TavernToggleWorld;
        window.TavernToggleRegex = TavernToggleRegex;
        window.TavernTestConnection = TavernTestConnection;
        window.TavernSaveAPI = TavernSaveAPI;

        // åˆå§‹åŒ–: åŠ è½½ä¿å­˜çš„APIé…ç½® (å¦‚æœæœ‰)
        (function loadSettings() {
            const api = localStorage.getItem('AI_Phone_API');
            if (api) {
                try {
                    const { platform, key, url } = JSON.parse(api);
                    document.getElementById('api-platform').value = platform || 'openai';
                    document.getElementById('api-key').value = key || '';
                    document.getElementById('api-url').value = url || '';
                } catch (e) {}
            }
            const tavernAPI = localStorage.getItem('Tavern_API');
            if (tavernAPI) {
                try {
                    const { platform, key, url } = JSON.parse(tavernAPI);
                    document.getElementById('tavern-api-platform').value = platform || 'openai';
                    document.getElementById('tavern-api-key').value = key || '';
                    document.getElementById('tavern-api-url').value = url || '';
                } catch (e) {}
            }
        })();

        // å…¨å±€å¯¼å‡ºå‡½æ•°ä¾›onclickä½¿ç”¨
        window.showScreen = showScreen;
        window.switchHomePage = switchHomePage;
        window.enterChat = enterChat;
        window.goBackFromChat = goBackFromChat;
        window.sendMessage = sendMessage;
        window.showEmojiPanel = showEmojiPanel;
        window.insertEmoji = insertEmoji;
        window.sendTransfer = sendTransfer;
        window.sendGift = sendGift;
        window.takePhoto = takePhoto;
        window.showChatSettings = showChatSettings;
        window.showAddFriendModal = showAddFriendModal;
        window.selectWallpaper = selectWallpaper;
        window.applyToAll = applyToAll;
        window.uploadWallpaper = uploadWallpaper;
        window.testAPIConnection = testAPIConnection;
        window.saveAPISettings = saveAPISettings;
    </script>
</body>
</html>
